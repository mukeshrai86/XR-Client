<!--
  @Type: File, <html>
  @Name: client-notes.component.html
  @Who: Renu
  @When: 14-Dec-2021
  @Why: EWM-3751 EWM-4175
  @What: Job list of candidate
  -->

<div *ngIf="loading" class="logo-loader">
    <div class="logo-loading"></div>
</div>

<mat-drawer-container class="common-notes-sec" id="common-notes-sec-client" [class.example-is-mobile]="mobileQuery.matches" autosize>
    <mat-drawer #snav class="notes-yearfilter-drawer" position="start" [opened]="yearFilter.matches ? 'false' : 'true'" [mode]="yearFilter.matches ? 'over' : 'side'">
        <mat-accordion class="yearsFilter">
            <mat-expansion-panel *ngFor="let data of gridMonthYearCount" [expanded]="data.Year==currentYear?true:false">
                <mat-expansion-panel-header (click)="getClientNotesList(clientIdData,data.Year,'',pagneNo,searchValue)">
                    <mat-panel-title>
                        {{data.Year}} <span> ({{data.CountYearly}}) </span>
                    </mat-panel-title>
                </mat-expansion-panel-header>
                <div  class="monthWithData"   *ngFor="let month of data.ListNotesMonthly;let i=index"
                [class.active]="selectedIndex === i && data.Year==currentYear"
                    (click)="getClientNotesList(clientIdData,data.Year,month.Month,pagneNo,searchValue);setIndex(i)">
                    <div class="month-name">{{month.Month}}</div>
                    <mat-progress-bar mode="determinate" value="{{month.CountMonthly}}"></mat-progress-bar>
                    <div class="notes-ammount">{{month.CountMonthly}}</div>
                </div>
            </mat-expansion-panel>
        </mat-accordion>
    </mat-drawer>

    <mat-drawer #notesAdd class="advancedsearchDrawer notes-addEdit-drawer" position="end" mode="over" disableClose="true">
        <div class="notes-drawer">
            <div class="drawerTitleSec">
                <h4 class="text-overflow">
                    {{(formHeading=='Add'?'label_addNewNotes':formHeading=='View'?'label_viewNotes': 'label_editNewNotes')|translate}}
                    <button class="closeDrawerIcon" mat-stroked-button (click)="notesAdd.toggle();addNotes()">
                        <mat-icon>close</mat-icon>
                    </button>
                </h4>
            </div>
            <!-- @When: 11-08-2023 @who:Amit @why: EWM-13389 @what: add class -->
            <mat-card id="add-new-note" class="advancedsearchDrawerData pb-0 add-new-note" applyTabIndexes *ngIf="(isDrawerOpened) && (formHeading=='Add' || formHeading=='Edit')">
                <form [formGroup]="clientNotesForm" id="clientNote" class="pl-0 pr-0">
                    <div class="row mb-0">
                        <div class="col l12 m12 s12">
                            <mat-form-field>
                                <mat-label>{{'quickjob_filledDate' | translate}}</mat-label>
                                <input type="hidden" formControlName="Id">
                                <!---------@When: 13-03-2023 @who:maneesh singh @why: EWM-10160 add  [datePickerFormat]="getDateFormat" [placeholder]="getDateFormat"  and remove open method--------->
                                <input tabindex  matInput [matDatepicker]="picker2" tabindex
                                    id="quickjob-filledDate"  [(ngModel)]="dateFill"
                                    formControlName="NotesDate" [datePickerFormat]="getDateFormat" [placeholder]="getDateFormat"  required>
                                    <button *ngIf="clientNotesForm.value.NotesDate || clientNotesForm.controls['NotesDate'].hasError('matDatepickerParse')" id="clearBtn" matSuffix mat-icon-button aria-label="Clear"
                                    (click)="clearEndDate()">
                                    <mat-icon>close</mat-icon>
                                </button>
                                <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
                                <mat-datepicker #picker2></mat-datepicker>
                                <!-- <mat-error
                                    *ngIf="clientNotesForm.controls['NotesDate'].hasError('required') && clientNotesForm.controls['NotesDate'].touched">
                                    {{'quickjob_filledDate'|translate}} {{'label_errorreqired'|translate}}
                                </mat-error> -->
                            <!---------@When: 13-03-2023 @who:maneesh singh @why: EWM-10160 --------->
                            <mat-error *ngIf="clientNotesForm.controls['NotesDate'].hasError('required') && clientNotesForm.controls['NotesDate'].touched && !clientNotesForm.controls['NotesDate'].hasError('matDatepickerParse')"> {{'quickjob_filledDate'|translate}} {{'label_errorreqired'|translate}} </mat-error>
                            <mat-error *ngIf="clientNotesForm.controls['NotesDate'].hasError('invalidDate') && !clientNotesForm.controls['NotesDate'].hasError('required')"> {{'label_invalidDate' | translate}} </mat-error>
                            <mat-error *ngIf="clientNotesForm.controls['NotesDate'].hasError('matDatepickerParse') && !clientNotesForm.controls['NotesDate'].hasError('matDatepickerMax')"> {{'label_invalidDate' | translate}}</mat-error>
                            <!-- End  -->
                            </mat-form-field>
                        </div>
                        <div class="col l12 m12 s12">
                            <div class="ng-slectBox">
                                <app-custom-dropdown [selectedIn]="selectedCategory" tabindex
                                    (selectedOut)="onCategorychange($event)" [config]="dropDoneConfig">
                                </app-custom-dropdown>
                            </div>
                        </div>
                        <div class="col l12 m12 s12 counterTxt">
                            <mat-form-field>
                                  <!-- who:maneesh,what:ewm-14633.ewm-14633 and ewm-15061 change label,When:10/10/2023 -->
                                <mat-label>{{'label_recentnotestitle' | translate}}</mat-label>
                                <textarea type="text" tabindex formControlName="Subject" matInput tabindex
                                    (keyup)="onMessage($event.target.value)" id="document-comment" ></textarea>
                                <mat-error *ngIf="this.clientNotesForm.controls['Subject'].hasError('maxlength')">
                                    {{ 'label_recentnotestitle' |translate}} {{ 'label_errormaxlength200' |translate}}
                                </mat-error>
                            </mat-form-field>
                            <span class="countlabel">
                                {{maxMessage}} {{'label_characters' |translate}}
                            </span>
                        </div>
                        <!--Who:Ankit Rawat, What:EWM-16073-EWM-16218 Add new control Contact Dropdown, When:27Feb24-->
                        <div class="col l12 m12 s12">
                            <dropdown [configuration]="ContactsDropdownConfig"
                            (selectedOut)="onContactschange($event)" 
                            [getSelectedItem]="selectedContactsItems"
                            [showMoreOptionsNum]="maxMoreLengthForContacts"></dropdown>
                    </div> 
                        <div class="col l12 m12 s12">
                            <mat-form-field>
                                <mat-label>{{'label_access' | translate}}</mat-label>
                                  <!-- who:maneesh,what:ewm-11462.ewm-11525 add input (click)="openManageAccessModal('','','')" ,When:28/03/2023 -->
                                <input matInput placeholder="{{'label_access'|translate}}"  (click)="openManageAccessModal('','','')" formControlName="AccessName" tabindex required readonly>
                                <input type="hidden" formControlName="AccessId" >
                                <button type="button" matSuffix tabindex mat-raised-button color="primary" class="" tabindex
                                (click)="openManageAccessModal('','','')">

                                    <mat-icon class="addContactIcon">add</mat-icon>
                                </button>
                                <mat-error *ngIf="this.clientNotesForm.controls['AccessName'].hasError('required')">
                                    {{ 'label_access' |translate}} {{ 'label_errorreqired' |translate}}
                                </mat-error>
                            </mat-form-field>
                        </div>

                        <div class="col l12 m12 s12">
                            <div class="html-editor-kendo" tabindex id="kendoHTMLEditer">
                                <!---------@When: 15-03-2023 @who:Adarsh singh @why: EWM-10879 @Desc- Remove color on required --------->
                                <!-- //who:maneesh,what:ewm-15343 for show red discription titel,when:07/12/2023 -->
                    <mat-label
                     [ngStyle]="clientNotesForm.controls['Description'].hasError('required') && showErrorDesc?
                     {'color': '#f44336'}:''">{{ 'label_recentnotesdescription' | translate}} <span class="required-show">*</span></mat-label>
                    <app-mention-editor *ngIf="ShowEditor" #mentionEditor [configuration]="editorConfig" [getEditorVal]="getEditorVal"
                     (editorValueEmit)="getEditorFormInfo($event)" (editorImageValueEmit)="getEditorImageFormInfo($event)"
                     [getRequiredValidationMassage]="getRequiredValidationMassage.asObservable()"></app-mention-editor>
                              
                            </div>
                        </div>
 <!---------@When: 11-08-2023 @who:bantee kumar @why: EWM-13758 @Desc Multiple Uploading - Tenant ->Home →Job→ Job Summary → Notes --------->

                        <div class="activity-related">
                            <div class="matAttachment" *ngIf="this.fileAttachments.length>0" id="myActivity-documentAttachment">
                                <div *ngFor="let files of fileAttachmentsOnlyTow">
                                    <mat-card class="matCardAttach" id="myActivity-documentAttachmentCard">
                                        <div class="email-attachment">
                                            <div class="file-detail" tabindex>
                                                <span class="fileName">{{files.Name}}</span>
                                                <span class="fileSize">{{(files.Size)/1024}}</span>
                                            </div>
                                            <mat-icon  class="matCloseIcon" tabindex (click)="removeAttachment(files)"
                                            id="myActivity-documentRemove">close</mat-icon>
                                        </div>
                                    </mat-card>
                                </div>


                                <div *ngIf="this.fileAttachments.length>2">

                                    <button mat-stroked-button class="moreAttach" color="primary" (click)="openMultipleAttachmentModal()"
                            id="myActivity-documentAttachmentPopupShow" tabindex>{{fileAttachments?.length-2}} {{'label_more' |
                            translate}}..</button>


                                </div>
                            </div>

                        </div>
                    </div>

                </form>
                <mat-card class="drawer-footer">

                    <button mat-icon-button color="primary" tabindex class="fileUpload attachFileBtn"

                            (click)="openMultipleAttachmentModal()" id="myActivity-documentAttachmentAddPopup">
                            <mat-icon>attach_file</mat-icon>
                        </button>
                    <button mat-stroked-button color="warn" tabindex type="button" (click)="onDismiss()"
                        id="btnCancel">
                        {{'button_cancel'|translate}}</button>

                        <!-- // who:bantee,what:ewm-14049 ,when:27/08/2023 Notesattachment issue -->

                    <button mat-raised-button tabindex color="primary"
                        (click)="onSave(this.clientNotesForm.value)" type="button" id="btnSave"
                        [disabled]="!clientNotesForm.valid || isCategory || saveEnableDisable">
                        {{'label_save'|translate}}
                    </button>
                </mat-card>
            </mat-card>
            <mat-card id="add-new-note" class="advancedsearchDrawerData pb-0 add-new-note" *ngIf="formHeading=='View'">
                <div class="col nodata" *ngIf="this.gridListView==undefined ||this.gridListView?.length==0">
                    <span>{{notificationLoading | translate}}</span>
                  </div>
                <div class="common-notes-content view-notes-content" id="view-notes-drawer">
                    <!-- @When: 30-04-2024 @who:Amit @why: EWM-16850 @what: no access show -->
                    <ng-container *ngFor="let list of gridListView;let i=index; let last = last">
                    <div class="main-notes-detail" id="main-detail-notes" [ngClass]="[list?.AccessName=='Public' ? '' : 'confidential-protected']">    
                <div class="notes-detail mt-10"
                [class.notes-matcard-content]="!yearFilter.matches" [ngClass]="{'notes-detail-last': last}">
                <!-- <div class="notes-detail-linebar" [class.left-gap]="yearFilter.matches"></div> -->
                <div class="no-access" id="not-access" *ngIf="list?.AccessName=='Protected' || list?.AccessName=='Confidential'">
                    <svg viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
                        <path class="first-path" d="M641.80188 797.718a24.01 24.01 0 0 1-24.028 24.015H584.88088c-13.263 0-24.018-10.748-24.018-24.016 0-13.264 10.755-24.018 24.018-24.018h32.893c13.262 0.005 24.017 10.755 24.028 24.019z m0 0"></path>
                        <path class="white-path" d="M708.23688 210.098H289.12288s-32.227-4.026-34.262 38.291c-2.02 42.305 0 486.035 0 543.744-0.677 47.117 57.732 57.383 78.587 30.553 28.216-34.246 10.078-74.561 4.043-76.584-6.062-2.031 392.934 0 392.934 0V264.5c-0.001 0 5.562-54.515-22.188-54.402z m0 0"></path>
                        <path class="red-path" d="M300.61188 842.454c-14.448 0-28.14-5.471-37.553-15.045-8.966-9.096-13.605-21.328-13.402-35.357 0-12.902-0.102-45.41-0.236-88.504-0.461-147.648-1.332-422.482 0.236-455.407 1.53-31.97 20.248-43.353 37.249-43.353 1.803 0 2.871 0.146 2.871 0.146l418.46-0.033c6.804 0 12.468 2.507 16.951 7.464 14.031 15.528 10.563 51.164 10.417 52.673l0.032 486.307-5.235-0.02c-0.011 0-177.319-0.902-293.733-0.902-52.776 0-77.653 0.193-89.111 0.396 2.002 4.119 3.275 8.275 3.667 9.66 3.12 10.898 8.017 39.084-13.756 65.514-8.097 10.426-21.565 16.461-36.857 16.461z m-13.706-627.255c-7.588 0-25.393 3.27-26.843 33.436-1.557 32.655-0.697 307.319-0.236 454.874 0.135 43.107 0.236 75.641 0.236 88.623-0.16 11.26 3.431 20.898 10.401 27.959 7.49 7.592 18.471 11.945 30.148 11.945 12.05 0 22.52-4.568 28.711-12.553 13.832-16.779 15.169-34.219 13.875-45.908-1.407-12.756-6.304-21.51-8.005-22.836-1.836-0.52-3.334-2.975-2.916-5.508 0.328-2.047 0.526-3.287 6.846-4.039v-0.016l0.021 0.016c9.853-1.176 34.525-1.176 97.503-1.176 104.612 0 258.397 0.725 288.541 0.871V264.5c0.945-9.535 1.316-35.131-7.748-45.167a11.582 11.582 0 0 0-9.144-4.032H289.12288c-0.73-0.043-1.316-0.102-2.217-0.102z m0 0"></path>
                        <path class="grey-path" d="M309.11288 301.808h368.68v101.289h-368.68V301.808z m0 136.023h348.963v21.826H309.11288v-21.826z m0 53.941h184.332v21.82H309.11288v-21.82z m0 63.01H612.50088v21.826H309.11288v-21.826z m0 62.645h223.292v21.822H309.11288v-21.822z m543.465 83.677c9.053 9.043 11.608 21.393 5.719 27.578-5.863 6.18-18.004 3.85-27.035-5.213l-86.877-86.922c-9.031-9.043-11.598-21.398-5.687-27.576 5.858-6.186 17.998-3.852 27.014 5.213l86.866 86.92z m0 0"></path>
                        <path class="grey-path" d="M849.45888 734.749c-6.658 0-14.154-3.523-20.044-9.434l-86.867-86.922c-10.201-10.201-12.709-23.918-5.729-31.217 6.642-7.021 20.988-4.58 30.739 5.184l86.856 86.918c10.201 10.182 12.747 23.895 5.761 31.201-2.641 2.793-6.346 4.27-10.716 4.27zM747.51488 608.122c-2.014 0-4.864 0.451-6.921 2.637-4.864 5.068-2.266 16.039 5.638 23.953l86.866 86.92c4.94 4.941 11.056 7.893 16.361 7.893 2.024 0 4.875-0.449 6.948-2.637 4.854-5.078 2.238-16.043-5.665-23.938l-86.861-86.93c-4.935-4.945-11.05-7.898-16.366-7.898z m0 0"></path>
                        <path class="white-path" d="M751.42388 458.224c-47.632-47.643-125.172-47.643-172.836 0.023-47.691 47.641-47.702 125.219-0.032 172.883 47.675 47.633 125.226 47.633 172.868 0 47.642-47.664 47.642-125.264 0-172.906"></path>
                        <path class="grey-path" d="M664.99788 672.062a126.68 126.68 0 0 1-90.126-37.258 126.54 126.54 0 0 1-37.274-90.131c0-34.086 13.257-66.098 37.296-90.117a126.572 126.572 0 0 1 90.12-37.274 126.6 126.6 0 0 1 90.083 37.249c49.688 49.693 49.688 130.568 0 180.273a126.577 126.577 0 0 1-90.099 37.258z m0.026-244.363c-31.293 0-60.685 12.164-82.753 34.23a116.226 116.226 0 0 0-34.257 82.754c0 31.305 12.15 60.697 34.219 82.764 22.074 22.063 51.461 34.197 82.765 34.197s60.685-12.135 82.742-34.197c45.641-45.65 45.641-119.898 0-165.527a116.105 116.105 0 0 0-82.716-34.221z m0 0"></path>
                        <path class="light-grey-path" d="M732.10988 516.892h-14.965v-5.214h14.965v5.214z m-30.594 0H685.89088v-5.214h15.625v5.214z m-31.245 0h-15.63v-5.214h15.63v5.214z m-31.261 0H623.39088v-5.214h15.619v5.214z m-31.234 0h-15.631v-5.214h15.631v5.214z m85.734-42.629h-15.625v-5.215h15.625v5.215z m-31.245 0h-15.619v-5.215h15.619v5.215z m-31.25 0h-15.63v-5.215h15.63v5.215z m115.545 98.347h-14.605v-5.215h14.605v5.215z m-30.225 0H700.72088v-5.215h15.614v5.215z m-31.245 0h-15.63v-5.215h15.63v5.215z m-31.25 0h-15.63v-5.215h15.63v5.215z m-31.261 0h-15.614v-5.215h15.614v5.215z m-31.233 0h-15.631v-5.215h15.631v5.215z m108.505 52.28h-15.63v-5.213h15.63v5.213z m-31.261 0h-15.614v-5.213h15.614v5.213z m-31.234 0h-15.631v-5.213h15.631v5.213z m0 0M331.66988 742.519s38.337 72.16-33.065 94.742c0 0-3.828-0.412 0 0 79.994-0.717 460.272 1.988 460.272 1.988s30.224-18.832 38.547-39.303c8.285-20.447-6.046-49.33-18.144-57.732-26.417-2.578-447.61 0.305-447.61 0.305z m0 0"></path>
                        <path class="red-path" d="M759.61188 841.849h-0.757c-2.959-0.023-297.074-2.105-420.388-2.105-16.484 0-30.01 0.031-39.443 0.113l-0.145 0.053-4.236-0.461-0.328-2.518 0.134-2.471h2.47l0.279 0.037v-0.016l1.16 0.127c18.916-6.092 31.438-16.365 37.236-30.52 11.104-27.113-6.046-60.029-6.212-60.357l-2.019-3.791 4.291-0.035c2.019-0.014 202.814-1.369 334.316-1.369 67.987 0 106.207 0.359 113.574 1.078l0.671 0.07 0.563 0.379c13.424 9.322 27.669 39.66 19.067 60.854-8.549 21.012-38.312 39.74-39.584 40.539l-0.649 0.393z m-421.145-7.309c120.216 0 402.722 1.982 419.658 2.105 4.312-2.803 29.623-19.818 36.888-37.678 7.78-19.232-5.955-46.205-16.667-54.221-8.692-0.666-46.482-0.986-112.376-0.986-121.043 0-300.816 1.158-330.171 1.334 4.403 9.854 14.449 36.916 4.628 60.955-4.999 12.242-14.401 21.799-28.039 28.533 7.421-0.032 16.216-0.042 26.079-0.042z m0 0"></path>
                        <path class="red-path" d="M602.512147 511.99738l402.747939-402.747939a63.999673 63.999673 0 0 0-90.509537-90.509537L512.00261 421.487843 109.254671 18.749904a63.999673 63.999673 0 0 0-90.509537 90.509537L421.493073 511.99738 18.755134 914.745319a63.999673 63.999673 0 0 0 90.509537 90.509537L512.00261 602.506917l402.747939 402.747939a63.999673 63.999673 0 0 0 90.509537-90.509537z" style="transform: translate(614px,495px) scale(.1);"></path></svg>
                    <span>{{'label_employeeNotes_YouAnyAccess'|translate}}</span>
                </div>
                <div class="flex-box" id="flex-box-hover" (mouseenter)="onHover(i)" (mouseleave)="onHover(-1)"
                *ngIf="list?.AccessName!='Protected' && list?.AccessName!='Confidential'">
                    <mat-expansion-panel #panel1 hideToggle [expanded]="true" class="notes-info {{list.AccessName| lowercase }} mat-elevation-z1">
                        <mat-expansion-panel-header #panelH (click)="panelH._toggle()" class="{{list?.AccessName| lowercase }} notes-created-by-action screening-notes-drawer">
                            <mat-panel-title class="notes-created-header"> 
                                <div class="userAvtaarAndName {{list.AccessName| lowercase }}" id="user-avtaar-name">
                                  <img *ngIf="list?.ProfileImageUrl!='' && list?.ProfileImageUrl!=null" src="{{list?.ProfileImageUrl}}" alt="user">
                                  <span *ngIf="list?.ProfileImageUrl =='' || list?.ProfileImageUrl==null "  [style.background]="getBackgroundColor(list?.Shortname)" tabindex>{{list?.Shortname}}</span>
                                </div>
                                <div class="notes-created"> 
                                    <div class="notes-created-data">
                                        {{list?.CreatedByName}} <span class="event-name {{list.AccessName| lowercase }}">{{list?.EventName}}</span> {{'label_noteKey'|translate}} 
                                        <span class="{{list.AccessName| lowercase }}">
                                            {{list?.LastUpdated|
                                                date:userpreferences.timeformate:userpreferences.timezone}}
                                        </span> 
                                        <mat-icon class="{{list.AccessName| lowercase }}" matTooltip="{{list.AccessName}}"
                                        matTooltipClass="custom-tooltip">privacy_tip</mat-icon>
                                    </div>
                                    <div class="title" id="recent-title">
                                      <p>{{'label_recentnotestitle' | translate}} :</p> <span>{{list?.Subject}}</span>
                                    </div>
     
                                    <div class="title contact-show" id="contacted-show" *ngIf="list?.NotesContacts.length>0">
                                      <span class="contact">{{'label_JobContacts' | translate}} :</span>
                                      <mat-chip-list class="name-chips" id="name-list-chips">
                                          <ng-container *ngFor="let contact of list?.NotesContacts">
                                            <mat-chip  id="contactchiplist" [removable]="false" matTooltip="{{contact.FirstName}} {{contact.LastName}}" 
                                            matTooltipClass="custom-tooltip" class="contact-chip">
                                              <span class="skill-name">{{contact.FirstName}} {{contact.LastName}}</span>
                                            </mat-chip>
                                          </ng-container>
                                      </mat-chip-list>
                                    </div>
      
                                    <!--Who:Ankit Rawat, What:EWM-16073-EWM-16218 Add new label to show Contacts, When:27Feb24-->
                                </div>
                            </mat-panel-title>
                        </mat-expansion-panel-header>
                        <mat-card class="notes-created-details mat-elevation-z0">
                            <ng-container>
                                <div class="user-main-data close" id="user-notes-data{{list.Id}}"
                                    [ngClass]="{'user-notes-desc': selectedItemListForActiveClass === i}">
                                    <div class="user-notes-data"
                                        [innerHTML]="(isReadMore[i]) ? list.Description : list.Description | safeHtml">
                                    </div>
                                </div>
                            </ng-container>
      
                            <div class="attachment-data">
                                <ng-container *ngIf="list?.Files">
                                    <a *ngFor="let files of list.Files | slice : 0 : 4" mat-icon-button
                                        href="{{files.PreviewUrl}}" target="_blank" matTooltipPosition="left"
                                        matTooltip="{{'label_download' | translate}} - {{files.Name}}">
                                        <mat-icon class="cursor">
                                            {{getIcon(files?.Name)}}
                                        </mat-icon>
                                    </a>
                                </ng-container>
                                <ng-container>
                                    <button mat-icon-button *ngIf="list.Files?.length>4" id="all-Attachement"
                                        class="all-Attachement hiddenMenu" color="primary"
                                        [matMenuTriggerFor]="showAttachement">
                                        <mat-icon>more_vert</mat-icon>
                                    </button>
      
                                    <mat-menu #showAttachement="matMenu" class="all-owner-list owner-hover-list"
                                        id="respinsiveSidebarDropdown" xPosition="before">
                                        <mat-list role="list">
                                            <ng-container *ngFor="let files of list.Files | slice : 4 : list.Files?.length">
                                                <mat-list-item>
                                                    <a mat-icon-button href="{{files?.PreviewUrl}}" target="_blank"
                                                        matTooltipClass="custom-tooltip"
                                                        matTooltip="{{'label_download' | translate}} - {{files?.Name}}">
                                                        <mat-icon class="cursor">{{getIcon(files?.Name)}}</mat-icon>
                                                        {{files?.Name}}
                                                    </a>
                                                </mat-list-item>
                                            </ng-container>
                                        </mat-list>
                                    </mat-menu>
      
                                </ng-container>
                            </div>
                        </mat-card>
                    </mat-expansion-panel>
                </div>
                </div>
              </div>
            </ng-container>
            </div>
            </mat-card>
        </div>
    </mat-drawer>

    <mat-drawer-content infinite-scroll [infiniteScrollDistance]="1" [infiniteScrollThrottle]="50"
    (scrolled)="onScrollDown()" [scrollWindow]="false" #target class="common-notes-content" id="common-notes-content-client">
        <div class="notes-detail-action">
            <div class="left-data-header">
                <button mat-icon-button (click)="snav.toggle()" [ngClass]="yearFilter.matches ? '' : 'hide'">
                    <mat-icon>menu</mat-icon>
                </button>
                <strong> {{'label_Notes'|translate}}</strong>
            </div>
            <div class="left-data-header">
                                  <!-- who:maneesh,when:20/11/2023,what :ewm-15142 for search  and disable all filter icon for ewm-15409 -->
                                  <mat-form-field class="mb-0 searchInput" floatLabel="never">
                                    <mat-label>{{'label_search'|translate}}</mat-label>
                                    <input matInput id="userInvitaion-searchBox" tabindex="1" placeholder="Search" [disabled]="gridList==null && CategoryIds?.length==0 && OwnerIds?.length==0 &&filterConfig==null && searchdata=='' && FromDate==null && ContactsIds?.length==0"
                                        (input)="onFilter($event.target.value)" [(ngModel)]="searchValue">
                                    <mat-icon matPrefix style="position: relative; top: 7px;">search</mat-icon>
                                    <button *ngIf="searchValue" matSuffix mat-icon-button aria-label="Clear" (click)="onFilterClear()">
                                        <mat-icon>close</mat-icon>
                                    </button>
                                    <div *ngIf="loadingSearch" class="k-i-loading inputSearch"></div>
                                </mat-form-field>
                      <!-- who:maneesh,when:10/10/2033,what :ewm-14684 -->
                    <div class="button-with-clear only-clear">
                        <button mat-raised-button class="header-button p-0" id="btnRefresh" (click)="refreshComponent()"
                            matTooltip="{{'label_refreshBtn'|translate}}" matTooltipClass="card-list-tooltip" matTooltipPosition="before"
                            (mouseenter)="mouseoverAnimation(animationVar?.RotateButton?.id, animationVar?.RotateButton?.animation)"
                            (mouseleave)="mouseleaveAnimation(animationVar?.RotateButton?.id, animationVar?.RotateButton?.animation)">
                            <mat-icon id="{{animationVar?.RotateButton?.id}}" class="{{animationVar?.RotateButton?.isAnimClass}}">
                                {{animationVar?.RotateButton?.iconName}}</mat-icon>
                        </button>
                    </div>
                    <div class="button-with-clear">
                        <button mat-raised-button class="more-filter" id="filter-contacts" [disabled]="gridList==null && CategoryIds?.length==0 && OwnerIds?.length==0 && filterConfig==null && searchdata=='' && FromDate==null && ContactsIds?.length==0"
                         [ngClass]="[ filterCountContacts!=0 ? 'addFilter' : 'blankFilter']"
                          (click)="openDialogSearchByContact()" matTooltip="{{'label_searchByContact'|translate}}"
                          matTooltipClass="card-list-tooltip" matTooltipPosition="before"
                          (mouseenter)="mouseoverAnimation(animationVar?.PersonButton?.id, animationVar?.PersonButton?.animation)"
                          (mouseleave)="mouseleaveAnimation(animationVar?.PersonButton?.id, animationVar?.PersonButton?.animation)">
                          <mat-icon fontSet="material-icons-outlined" id="{{animationVar?.PersonButton?.id}}" class="{{animationVar?.PersonButton?.isAnimClass}}">contacts</mat-icon>
                        </button>
                        <div class="clear-with-data" *ngIf="filterCountContacts!=0" (click)="clearFilterData('Contact')">
                          <span class="text-overflow filterCount">{{filterCountContacts}}</span>
                          <button mat-icon-button color="warn">
                            <mat-icon>close</mat-icon>
                          </button>
                        </div>
                      </div>

                    <!------------------Date Filter------------------->
                    <div class="button-with-clear only-clear">
                        <!-- @When: 27-09-2023 @who:Amit @why: EWM-14465 @what: add animation -->
                        <button mat-raised-button class="more-filter" id="filter-date" [disabled]="gridList==null && CategoryIds?.length==0 && OwnerIds?.length==0 && filterConfig==null && searchdata=='' && FromDate==null && ContactsIds?.length==0"
                         [ngClass]="[ filterCountDate!=0 ? 'addFilter' : 'blankFilter']"
                          (click)="openDateFilterDialog()" matTooltip="{{'label_clientfilterdate'|translate}}"
                          matTooltipClass="card-list-tooltip" matTooltipPosition="before"
                          (mouseenter)="mouseoverAnimation(animationVar?.FilterButton?.id, animationVar?.FilterButton?.animation)"
                          (mouseleave)="mouseleaveAnimation(animationVar?.FilterButton?.id, animationVar?.FilterButton?.animation)">
                          <mat-icon fontSet="material-icons-outlined" id="{{animationVar?.FilterButton?.id}}" class="{{animationVar?.FilterButton?.isAnimClass}}">date_range</mat-icon>
                        </button>
                        <div class="clear-with-data" *ngIf="filterCountDate!=0" (click)="clearFilterData('Date')">
                          <!-- <span class="text-overflow filterCount">{{filterCount}}</span> -->
                          <button mat-icon-button color="warn">
                            <mat-icon>close</mat-icon>
                          </button>
                        </div>
                      </div>


                    <!------------------Owner Filter------------------->
                    <div class="button-with-clear">
                        <!-- @When: 27-09-2023 @who:Amit @why: EWM-14465 @what: add animation -->
                        <button mat-raised-button class="more-filter" id="filter-owner" [disabled]="gridList==null && CategoryIds?.length==0 && OwnerIds?.length==0 &&filterConfig==null && searchdata=='' && FromDate==null && ContactsIds?.length==0"
                         [ngClass]="[ filterCountOwner!=0 ? 'addFilter' : 'blankFilter']"
                          (click)="openDialogforowner()" matTooltip="{{'label_clientfilterOwner'|translate}}"
                          matTooltipClass="card-list-tooltip" matTooltipPosition="before"
                          (mouseenter)="mouseoverAnimation(animationVar?.PersonButton?.id, animationVar?.PersonButton?.animation)"
                          (mouseleave)="mouseleaveAnimation(animationVar?.PersonButton?.id, animationVar?.PersonButton?.animation)">
                          <mat-icon fontSet="material-icons-outlined" id="{{animationVar?.PersonButton?.id}}" class="{{animationVar?.PersonButton?.isAnimClass}}">person </mat-icon>
                        </button>
                        <div class="clear-with-data" *ngIf="filterCountOwner!=0" (click)="clearFilterData('Owner')">
                          <span class="text-overflow filterCount">{{filterCountOwner}}</span>
                          <button mat-icon-button color="warn">
                            <mat-icon>close</mat-icon>
                          </button>
                        </div>
                      </div>


                   <!------------------Category Filter------------------->

                   <div class="button-with-clear">
                    <!-- @When: 27-09-2023 @who:Amit @why: EWM-14465 @what: add animation -->
                    <button mat-raised-button class="more-filter" id="filter-category" [disabled]="gridList==null && CategoryIds?.length==0 && OwnerIds?.length==0 &&filterConfig==null && searchdata=='' && FromDate==null  && ContactsIds?.length==0"
                     [ngClass]="[ filterCountCategory!=0 ? 'addFilter' : 'blankFilter']"
                      (click)="openDialogJobCategory()" matTooltip="{{'label_notesCategory'|translate}}"
                      matTooltipClass="card-list-tooltip" matTooltipPosition="before"
                      (mouseenter)="mouseoverAnimation(animationVar?.CategoryButton?.id, animationVar?.CategoryButton?.animation)"
                      (mouseleave)="mouseleaveAnimation(animationVar?.CategoryButton?.id, animationVar?.CategoryButton?.animation)">
                      <mat-icon fontSet="material-icons-outlined" id="{{animationVar?.CategoryButton?.id}}" class="{{animationVar?.CategoryButton?.isAnimClass}}">category </mat-icon>
                    </button>
                    <div class="clear-with-data" *ngIf="filterCountCategory!=0" (click)="clearFilterData('Category')">
                      <span class="text-overflow filterCount">{{filterCountCategory}}</span>
                      <button mat-icon-button color="warn">
                        <mat-icon>close</mat-icon>
                      </button>
                    </div>
                  </div>

                   <!------------------Advanced Filter------------------->
                   <div class="button-with-clear">
                    <!-- who:maneesh,what:ewm-15061 for disable filter btn when no notes,when:23/11/2023 -->
                    <button mat-raised-button class="more-filter" id="filter-advance"
                     [ngClass]="[ filterCount!=0 ? 'addFilter' : 'blankFilter']" [disabled]="gridList==null && CategoryIds?.length==0 && OwnerIds?.length==0 &&filterConfig==null && searchdata=='' && FromDate==null  && ContactsIds?.length==0"
                      (click)="openFilterModalDialog()" matTooltip="{{'label_filters'|translate}}"
                      matTooltipClass="card-list-tooltip" matTooltipPosition="before"
                      (mouseenter)="mouseoverAnimation(animationVar?.AssignFilterButton?.id, animationVar?.AssignFilterButton?.animation)"
                      (mouseleave)="mouseleaveAnimation(animationVar?.AssignFilterButton?.id, animationVar?.AssignFilterButton?.animation)">
                      <mat-icon fontSet="material-icons-outlined" id="{{animationVar?.AssignFilterButton?.id}}" class="{{animationVar?.AssignFilterButton?.isAnimClass}}">filter_alt</mat-icon>
                    </button>
                    <div class="clear-with-data" *ngIf="filterCount!=0" (click)="clearFilterData('Filter')">
                      <span class="text-overflow filterCount">{{filterCount}}</span>
                      <button mat-icon-button color="warn">
                        <mat-icon>close</mat-icon>
                      </button>
                    </div>
                  </div>

            </div>
        </div>
        <div class="col nodata center-align p-15" *ngIf="this.gridList==undefined ||this.gridList.length==0">
            <p class="mb-15">{{'label_noNotessAddedYet' | translate}}</p>
            <button type="button" (click)="notesAdd.toggle();formType('Add')" color="primary" mat-raised-button
            matTooltipClass="custom-tooltip">
            <mat-icon>
              add
            </mat-icon> {{'label_add' | translate}}
          </button>
          </div>
          <div class="notes-detail" *ngFor="let list of gridList;let i=index; let last = last"
          [class.notes-matcard-content]="!yearFilter.matches" [ngClass]="{'notes-detail-last': last}">
          <div class="notes-detail-linebar" [class.left-gap]="yearFilter.matches"></div>
          <div class="flex-box" id="flex-box-hover" (mouseenter)="onHover(i)" (mouseleave)="onHover(-1)">
              <div class="notes-created-info-icon">
                  <button mat-mini-fab color="primary" disableRipple="true" matTooltip="{{list.CategoryName}}"
                      matTooltipClass="custom-tooltip">
                      <mat-icon>{{list?.IconName}}</mat-icon>
                  </button>
              </div>
              <mat-expansion-panel #panel1 hideToggle class="notes-info {{list.AccessName| lowercase }} mat-elevation-z1">
                  <mat-expansion-panel-header #panelH (click)="panelH._toggle()" class="{{list?.AccessName| lowercase }} notes-created-by-action screening-notes-drawer">
                      <mat-panel-title class="notes-created-header"> 
                          <div class="userAvtaarAndName {{list.AccessName| lowercase }}" id="user-avtaar-name">
                            <img *ngIf="list?.ProfileImageUrl!='' && list?.ProfileImageUrl!=null" src="{{list?.ProfileImageUrl}}" alt="user">
                            <span *ngIf="list?.ProfileImageUrl =='' || list?.ProfileImageUrl==null "  [style.background]="getBackgroundColor(list?.Shortname)" tabindex>{{list?.Shortname}}</span>
                          </div>
                          <div class="notes-created"> 
                              <div class="notes-created-data">
                                  {{list?.CreatedByName}} <span class="event-name {{list.AccessName| lowercase }}">{{list?.EventName}}</span> {{'label_noteKey'|translate}} 
                                  <span class="{{list.AccessName| lowercase }}">
                                      {{list?.LastUpdated|
                                          date:userpreferences.timeformate:userpreferences.timezone}}
                                  </span> 
                                  <mat-icon class="{{list.AccessName| lowercase }}" matTooltip="{{list.AccessName}}"
                                  matTooltipClass="custom-tooltip">privacy_tip</mat-icon>
                              </div>
                              <div class="title" id="recent-title">
                                <p>{{'label_recentnotestitle' | translate}} :</p> <span>{{list?.Subject}}</span>
                              </div>
        <!--Who:Ankit Rawat, What:EWM-13076-EWM-16479 Add count show button contacts in notes section., When:19March24-->
                              <div class="title contact-show" id="contacted-show" *ngIf="list?.NotesContacts?.length>0">
                                <span class="contact">{{'label_JobContacts' | translate}} :</span>
                                <mat-chip-list class="name-chips" id="name-list-chips" #chipList aria-label="tag selection">
                                    <ng-container *ngFor="let contact of list?.NotesContacts, let i = index;">
                                      <mat-chip *ngIf="i<5" id="contactchiplist" [removable]="false" matTooltip="{{contact.FirstName}} {{contact.LastName}}" 
                                      matTooltipClass="custom-tooltip" class="contact-chip">
                                        <span class="skill-name">{{contact.FirstName}} {{contact.LastName}}</span>
                                      </mat-chip>
                                    </ng-container>
                                    <button mat-flat-button *ngIf="list?.NotesContacts?.length>5" class="max-count-box mt-0"
                                        [matMenuTriggerFor]="showAllOwner" name="btnMore" id="btnMore" id="jobSlill_">
                                        +{{list?.NotesContacts?.length-5}}
                                    </button>
                                </mat-chip-list>
                                <mat-menu #showAllOwner="matMenu" class="menu-dropdown" id="respinsiveSidebarDropdown" xPosition="before">
                                    <ng-container *ngFor="let contact of list?.NotesContacts, let i = index;">
                                      <button mat-button *ngIf="i>=5">
                                        {{contact.FirstName}} {{contact.LastName}}
                                      </button>
                                    </ng-container>
                                </mat-menu>
                              </div>

                              <!--Who:Ankit Rawat, What:EWM-16073-EWM-16218 Add new label to show Contacts, When:27Feb24-->
                          </div>
                      </mat-panel-title>

                      <mat-panel-description class="notes-created-action">
                          <div class="group-btn" id="group-button">
                              <button mat-icon-button class="edit-delete" color="primary" id="editBtn__{{i}}"
                                  (click)="notesAdd.toggle();editClientForm(list?.Id,'Edit',list?.CallReferenceId)"
                                  matTooltip="{{'label_edit'|translate}}" matTooltipClass="custom-tooltip"
                                  [disabled]="list.Edit=='0'?true:false">
                                  <mat-icon>edit</mat-icon>
                              </button>
                              <button mat-icon-button class="edit-delete" id="deleteBtn__{{i}}" color="warn" (click)="deleteClientNotes(list)"
                                  matTooltip="{{'label_delete'|translate}}" matTooltipClass="custom-tooltip"
                                  [disabled]="list.Delete=='0'?true:false">
                                  <mat-icon>delete</mat-icon>
                              </button>
                          </div>
                          <button mat-icon-button tabindex *ngIf="!panel1.expanded" class="up-down" id="btn_expand"
                          (click)="panelH._toggle()">
                          <mat-icon fontSet="material-icons-outlined">expand_more</mat-icon>
                          </button>
                          <button mat-icon-button tabindex *ngIf="panel1.expanded" class="up-down" id="btn_less"
                          (click)="panelH._toggle()">
                          <mat-icon>expand_less</mat-icon>
                          </button>
                      </mat-panel-description>

                  </mat-expansion-panel-header>
                  <mat-card class="notes-created-details mat-elevation-z0">
                      <ng-container>
                          <div class="user-main-data close" id="user-notes-data{{list.Id}}"
                              [ngClass]="{'user-notes-desc': selectedItemListForActiveClass === i}">
                              <div class="user-notes-data"
                                  [innerHTML]="(isReadMore[i]) ? list.Description : list.Description | safeHtml">
                              </div>
                          </div>
                      </ng-container>

                      <div class="attachment-data">
                          <ng-container *ngIf="list?.Files">
                              <a *ngFor="let files of list.Files | slice : 0 : 4" mat-icon-button
                                  href="{{files.PreviewUrl}}" target="_blank" matTooltipPosition="left"
                                  matTooltip="{{'label_download' | translate}} - {{files.Name}}">
                                  <mat-icon class="cursor">
                                      {{getIcon(files?.Name)}}
                                  </mat-icon>
                              </a>
                          </ng-container>
                          <ng-container>
                              <button mat-icon-button *ngIf="list.Files?.length>4" id="all-Attachement"
                                  class="all-Attachement hiddenMenu" color="primary"
                                  [matMenuTriggerFor]="showAttachement">
                                  <mat-icon>more_vert</mat-icon>
                              </button>

                              <mat-menu #showAttachement="matMenu" class="all-owner-list owner-hover-list"
                                  id="respinsiveSidebarDropdown" xPosition="before">
                                  <mat-list role="list">
                                      <ng-container *ngFor="let files of list.Files | slice : 4 : list.Files?.length">
                                          <mat-list-item>
                                              <a mat-icon-button href="{{files?.PreviewUrl}}" target="_blank"
                                                  matTooltipClass="custom-tooltip"
                                                  matTooltip="{{'label_download' | translate}} - {{files?.Name}}">
                                                  <mat-icon class="cursor">{{getIcon(files?.Name)}}</mat-icon>
                                                  {{files?.Name}}
                                              </a>
                                          </mat-list-item>
                                      </ng-container>
                                  </mat-list>
                              </mat-menu>

                          </ng-container>
                      </div>
                  </mat-card>
              </mat-expansion-panel>
          </div>
        </div>
        <div *ngIf="loadingscroll" class="k-i-loading scrollloading"></div>
        <button mat-fab class="addClientButton topToBottom" matTooltipPosition="left" matTooltip="{{'label_addNewNotes'|translate}}"
        color="primary" id="btnCreate" (click)="notesAdd.toggle();formType('Add')" *ngIf="hideAddButton">
            <div class="two-icons">
                <mat-icon>notes</mat-icon>
                <mat-icon class="secondIcon" fontSet="material-icons-outlined">add</mat-icon>
            </div>
        </button>
    </mat-drawer-content>

</mat-drawer-container>
