<!--@(C): Entire Software | @Type: File, <ts> | @Name: lead-workflows-manage.component.html | @Who: Renu | @When: 18-June-2024 | @Why: EWM-18938 EWM-18965 | @What: For LEAD workflows -->
    <div *ngIf="loading" class="logo-loader" id="logo-loader">
        <div class="logo-loading"></div>
    </div>
    <mat-card-header class="dashboard-mat-card-header title-and-btn" id="job-workflow-manage-mat-card-header">
        <mat-card-title class="only-title" *ngIf="activestatus=='Add' && !isClone">{{ "label_add" | translate }} {{ "label_MenuleadWorkflow"
            | customTranslate }}</mat-card-title>
        <mat-card-title class="only-title" *ngIf="activestatus=='Edit' && !isClone">{{ "label_edit" | translate }} {{
            "label_MenuleadWorkflow" | customTranslate }}</mat-card-title>
        <mat-card-title class="only-title" *ngIf="activestatus=='View' && !isClone">{{ "label_view" | translate }} {{
            "label_MenuleadWorkflow" | customTranslate }}</mat-card-title>
        <mat-card-title class="only-title" *ngIf="isClone">{{ "label_clone" | translate }} {{
                "label_MenuleadWorkflow" | customTranslate }}</mat-card-title>
        <div class="actionButton workflow-used">
            <button mat-raised-button *ngIf="jobid" tabindex (click)="redirectTo()" id="btnBack"
                class="backBtncolor">
                <span class="buttonTxt">{{'label_back' |translate}}</span>
            </button>
            <div *ngIf="!jobid">
                <button mat-raised-button *ngIf="mode=='R'" tabindex [routerLink]="['../']" [queryParams]="{V:viewMode}"
                    id="btnBack" class="backBtncolor">
                    <span class="buttonTxt">{{'label_back' |translate}}</span>
                </button>
            </div>
            <button mat-raised-button color="warn" *ngIf="mode=='E' || mode=='A'" tabindex id="btnCancel"
                [routerLink]="['../']" [queryParams]="{V:viewMode}">
                <span class="buttonTxt">{{ "label_cancel" | translate }}</span>
            </button>
            <button mat-raised-button tabindex *ngIf="mode=='E' || mode=='A'" color="primary"
                type="button" [disabled]="!JobWorkForm.valid || parentInfo().controls.length==0 || addstage" id="btnSave"
                (click)="onSave(this.JobWorkForm.getRawValue())">
                <!---------@When: 28-12-2022 @who:Adarsh singh @why: EWM-10008 --------->
                <span class="buttonTxt" *ngIf="!isClone">{{ "label_save" | translate }}</span>
                <span class="buttonTxt" *ngIf="isClone">{{ "label_clone" | translate }}</span>
                <!-- End  -->
            </button>
        </div>
    </mat-card-header>
    <mat-drawer-container class="xeople-container-with-one-card" autosize id="job-workflow-manage-drawer">
        <mat-card id="workflow-card" applyTabIndexes class="workflow-card component-card mat-elevation-z2 pt-0">
            <div class="chart-sec">
                <ngx-org-chart *ngIf="mode=='R'" [nodes]="nodes" direction="vertical"></ngx-org-chart>
            </div>
            <span class="warning-message" *ngIf="workflowUsed && mode!='R'">{{'label_leadflowMsg'|customTranslate}}</span>
            <div class="" *ngIf="mode!='R'">
                <form novalidate [formGroup]="JobWorkForm" (ngSubmit)="onSave(this.JobWorkForm.value)"
                    accept-charset="utf-8" id="commitment-form">
                    <div class="job-workflow sticky" id="job-workflow">
                        <mat-form-field>
                            <mat-label>{{ "label_wrokflowName" | translate }}</mat-label>
                            <input type="hidden" formControlName="Id" id="Id">
                            <input matInput formControlName="workflowName" id="workflow-Name"
                                (blur)="workflowExists(false)" placeholder="{{ 'label_wrokflowName' | translate }}"
                                required tabindex />
                            <mat-error *ngIf="JobWorkForm.controls['workflowName'].hasError('required')">
                                {{'label_wrokflowName'|translate}} {{'label_errorreqired'|translate}}
                            </mat-error>
                            <mat-error *ngIf="JobWorkForm.controls['workflowName'].hasError('maxlength')">
                                {{'label_wrokflowName'|translate}} {{'label_errormaxlength100'|translate}}
                            </mat-error>
                            <mat-error *ngIf="JobWorkForm.controls['workflowName'].hasError('codeTaken')">
                                {{JobWorkForm.controls['workflowName'].value}} {{'label_errorreqiredAlready'|translate}}
                            </mat-error>
                            <mat-error *ngIf="JobWorkForm.controls['workflowName'].hasError('whitespace')">
                                {{'label_nameValidation'|translate}}
                            </mat-error>
                            <mat-error *ngIf="JobWorkForm.controls['workflowName'].hasError('industryTaken')">
                                {{JobWorkForm.controls['workflowName'].value}} {{'label_with'|translate}}
                                {{'label_industry'|translate}}
                                {{JobWorkForm.controls['Industry'].value.Description}}
                                {{'label_errorreqiredAlready'|translate}}
                            </mat-error>
                            <mat-error *ngIf="JobWorkForm.controls['workflowName'].hasError('clientTypeTaken')">
                                {{JobWorkForm.controls['workflowName'].value}} {{'label_with'|translate}}
                                {{'label_ClientType'|translate}}
                                {{JobWorkForm.controls['clientType'].value.Name }}
                                {{'label_errorreqiredAlready'|translate}}
                            </mat-error>
                            <mat-error *ngIf="JobWorkForm.controls['workflowName'].hasError('IndustryclientTypeTaken')">
                                {{JobWorkForm.controls['workflowName'].value}} {{'label_with'|translate}}
                                {{'label_industry'|translate}}
                                {{JobWorkForm.controls['Industry'].value.Description}} & {{'label_ClientType'|translate}}
                                {{JobWorkForm.controls['clientType'].value.Name }}
                                {{'label_errorreqiredAlready'|translate}}
                            </mat-error>
                            <mat-error *ngIf="JobWorkForm.controls['workflowName'].hasError('pattern')">
                                {{'label_wrokflowName'|translate}} {{'label_errorspecialchar'|translate}}
                            </mat-error>
                        </mat-form-field>
                        <div class="ng-slectBox ng-select-with-info-icon">
                            <ng-select placeholder="{{'label_industry'|translate}}" class="dropdown-body"
                                appendTo="body" tabindex [clearable]="true" formControlName="Industry"
                                id="jobworkflow-industry" [compareWith]="compareFn" (change)="workflowExists(false)">
                                <ng-option value="" disabled>{{'label_industry'|translate}}</ng-option>
                                <ng-option *ngFor="let list of industryInfo" [value]="list">{{list.Description}}
                                </ng-option>
                            </ng-select>
                            <mat-icon class="infoStyle" tabindex="2" id="position-helpMsg" matTooltipPosition="left" matTooltip="{{'label_LeadindustryHelpIcon' |customTranslate}}">
                                info_outline
                            </mat-icon> 
                        </div>
                        <div class="select-group">
                            <div class="ng-slectBox ng-select-with-info-icon">
                                <ng-select placeholder="{{'label_ClientType'|translate}}" class="dropdown-body" appendTo="body"
                                    tabindex [clearable]="true" formControlName="clientType" id="jobworkflow-clientType"
                                    [compareWith]="compareFnClient" (change)="workflowExists(false)">
                                    <ng-option value="" disabled>{{'label_ClientType'|translate}}</ng-option>
                                    <ng-option *ngFor="let clientType of ClientTypeList" [value]="clientType">{{clientType.Name}}</ng-option>
                                </ng-select>
                                <mat-icon class="infoStyle" tabindex id="position-helpMsg"  matTooltipPosition="left" matTooltip="{{'label_ClientTypeHelpIcon' |customTranslate}}">
                                    info_outline
                                </mat-icon>
                            </div>
                            <div class="ng-slectBox">
                                <!-----@suika@EWM-10681 EWM-10818  @03-03-2023 to set default cross icon remove for status in master data--->    
                                <ng-select placeholder="{{'label_status'|translate}}" class="show-required" [clearable]="false" tabindex
                                    formControlName="Status" id="workflow-Status" required>
                                    <ng-option value="" disabled>{{'label_selectStatus'|translate}}</ng-option>
                                    <ng-option *ngFor="let status of statusList" [value]="status.StatusId">
                                        {{status.StatusName}}
                                    </ng-option>
                                </ng-select>
                                <mat-error *ngIf="JobWorkForm.controls['Status'].hasError('required') && JobWorkForm.controls['Status'].touched">
                                    {{ "label_status" | translate }} {{ "label_errorreqired" | translate }}
                                </mat-error>
                            </div>
                        </div>
                        <div>
                            <button  tabindex id="addbtn-newStage" mat-raised-button matSuffix color="primary"
                                [disabled]="JobWorkForm.controls['workflowName'].hasError('codeTaken') 
                                || JobWorkForm.controls['workflowName'].hasError('required')
                                || JobWorkForm.controls['Status'].hasError('required') 
                                || mode=='R' || workflowUsed || JobWorkForm.controls['workflowName'].hasError('whitespace')"
                                type="button" class="addNewStage"
                                (click)="addParentStage(parentInfo().controls.length)">
                                <mat-icon>add</mat-icon>
                                <span class="buttonTxt">{{"label_addNewStage" | translate}}</span>
                            </button>
                        </div>
                    </div>
                    <div class="workflowSec" id="workflowSec">
                        <div class="dynamictab" id="dynamictab">
                            <div cdkDropList (cdkDropListDropped)="dropParent($event)" class="example-list">
                                <ng-container formArrayName="Stages">
                                    <div *ngFor="let parent of parentInfo().controls; let i = index" [formGroupName]="i"
                                        cdkDrag
                                        [cdkDragDisabled]="parent.get('StageTypeCode').value==newLead || parent.get('StageTypeCode').value==Closing|| parent.get('workflowUsed').value"
                                        id="addStage{{i+1}}" [ngClass]="[userAnimationStatus?'animate__animated':'',(parent.get('StageTypeCode').value==newLead || parent.get('StageTypeCode').value==Closing ||  parent.get('workflowUsed').value)? 'first-and-last-stage': '']"
                                        class="deleteparent-{{i}}">
                                        <div class="parent-placeholder" *cdkDragPlaceholder></div>
                                        <div *cdkDragPreview class="parent-Preview">
                                            <mat-card class="expandCollapseContent firstStep">
                                                <button type="button" class="drag-handle" [disabled]="parent.get('StageTypeCode').value==newLead || parent.get('StageTypeCode').value==Closing" mat-raised-button color="primary" cdkDragHandle>
                                                    <mat-icon>drag_indicator</mat-icon>
                                                </button>
                                                <div class="all-control">
                                                    <div class="flex-row">
                                                        <div class="form-controls">
                                                            <div class="toggleButtonBox">
                                                                <button mat-icon-button class="drag-handle toggleButton"
                                                                    type="button"
                                                                    *ngIf="parent.get('Stages').controls.length>0"
                                                                    (click)="toggleParent(i)"
                                                                    [ngClass]="hideChildContent[i] ? 'unfold' : 'fold'">
                                                                    <mat-icon>keyboard_arrow_up</mat-icon>
                                                                </button>
                                                            </div>
                                                            <mat-form-field class="stageName mb-0" floatLabel="always">
                                                                <mat-label>{{ "label_stageName" | translate }} </mat-label>
                                                                <input type="hidden" formControlName="StageId"
                                                                    id="StageId_{{i}}">
                                                                <input type="hidden" formControlName="InternalCode"
                                                                    id="InternalCodes_{{i}}">
                                                                <input type="hidden" formControlName="ParentStageId"
                                                                    id="ParentStageId_{{i}}">
                                                                <input type="hidden" formControlName="IsDeleted"
                                                                    id="IsDeleted_{{i}}">
                                                                <input type="hidden" formControlName="WorkflowInternalCode"
                                                                    id="WorkflowInternalCode_{{i}}">
                                                                <input type="hidden" formControlName="IsNew"
                                                                    id="IsNew_{{i}}">
                                                                <input formControlName="StageName" tabindex
                                                                    (blur)="stageExists($event,parent.get('InternalCode').value,parent.get('ParentStageId').value,parent)"
                                                                    name="pStageName" matInput id="stageName_{{ i }}"
                                                                    placeholder="{{ 'label_stageName' | translate }}"
                                                                    required />
                                                                <mat-error
                                                                    *ngIf="parent.get('StageName').errors?.required && parent.get('StageName').touched">
                                                                    {{ 'label_stageName' |translate}} {{
                                                                    'label_errorreqired'
                                                                    |translate}}
                                                                </mat-error>
                                                                <mat-error
                                                                    *ngIf="parent.get('StageName').errors?.maxlength && parent.get('StageName').touched">
                                                                    {{ 'label_stageName' |translate}} {{
                                                                    'label_errormaxlength50'
                                                                    |translate}}
                                                                </mat-error>
                                                                <mat-error
                                                                    *ngIf="parent.get('StageName').errors?.unique && parent.get('StageName').touched">
                                                                    {{ 'label_stageName' |translate}} {{ 'label_errorunique'
                                                                    |translate}}
                                                                </mat-error>
                                                                <mat-error
                                                                    *ngIf="parent.get('StageName').hasError('stageTaken')">
                                                                    {{'label_stageName'|translate}}
                                                                    {{'label_errorreqiredAlready'|translate}}
                                                                </mat-error>
                                                            </mat-form-field>
                                                            <mat-form-field class="stageTextarea mb-0" floatLabel="always">
                                                                <mat-label>{{ "label_stageDesc" | translate }}</mat-label>
                                                                <textarea matInput tabindex formControlName="StageDesc"
                                                                    class="textareaHeight" id="StageDescp_{{ i }}"
                                                                    placeholder="{{ 'label_stageDesc' | translate }}"></textarea>
                                        
                                                                <mat-error
                                                                    *ngIf="parent.get('StageDesc').errors?.maxlength && parent.get('StageDesc').touched">
                                                                    {{ 'label_stageDesc' |translate}} {{
                                                                    'label_errormaxlength100'
                                                                    |translate}}
                                                                </mat-error>
                                                            </mat-form-field>
                                                            <mat-form-field class="mb-0 colorCode" floatLabel="always">
                                                                <mat-label>{{ "label_colorCode" |
                                                                    translate }}</mat-label>
                                                                    <input matInput formControlName="ColorCode" id="ColorCode_{{i}}" readonly>
            <!-- /*--@Who:Bantee,@When: 28-09-2023,@Why:EWM-12471,@What:When user swaps any two job workflow stage, color code of those stage is not swapped.-----*/ -->
        
                                                                    <div matSuffix class="color-picker-button" [ngStyle]="{backgroundColor:parent.get('ColorCode').value}" (click)="showColorPallate($event,'parent',i,null,null)" cdkOverlayOrigin #trigger="cdkOverlayOrigin">
                                                                    </div>
                                                                    <!-- --------@When: 14-03-2023 @who:Renu @why: EWM-10634 ewm-11123 Desc- Custome color picker -------- -->
                                                                    <ng-template cdkConnectedOverlay cdkConnectedOverlayBackdropClass="cdk-overlay-transparent-backdrop"
                                                                    [cdkConnectedOverlayHasBackdrop]="true" [cdkConnectedOverlayOrigin]="trigger" [cdkConnectedOverlayOpen]="showColorPallateContainer[i]"
                                                                    (backdropClick)="showColorPallateContainer[i] = false">
                                                                        <!-- color picker body  -->
                                                                        <div class="color-picker-default">
                                                                            <input type="color" id="head" name="head"  (input)="onChaneColor($event,'parent',i,null,null)">
                                                                        </div>
                                                                        <div class="color-picker-container" [style.opacity]="isMoreColorClicked ? '0' : ' '"
                                                                            [style.display]="isMoreColorClicked ? 'none' : ' '">
                                                                            <div class="themeColor">{{'label_selectColour' | translate}}</div>
                                                                            <div class="picker theme-color">
                                                                                <div (click)="onSelectColor(codes,'parent',i,null,null)" class="color-picker" *ngFor="let codes of themeColors"
                                                                                    [ngStyle]="{backgroundColor:codes.colorCode}"> </div>
                                                                            </div>
                                                                            <div class="picker standard-color">
                                                                                <div (click)="onSelectColor(codes,'parent',i,null,null)" class="color-picker" *ngFor="let codes of standardColor"
                                                                                    [ngStyle]="{backgroundColor:codes.colorCode}">
                                                                                </div>
                                                                            </div>
                                                                            
                                                                            <div class="footer">
                                                                                <div class="noFill" (click)="onSelectColor(null,'parent',i,null,null)">
                                                                                    <mat-icon>clear</mat-icon>
                                                                                    <div class="noFillText">{{'label_clear'| translate}}</div>
                                                                                </div>
                                                                                <div class="more" (click)="closeTemplate()">
                                                                                    <label for="head" class="noFill">
                                                                                        <mat-icon fontSet="material-icons-outlined">palette</mat-icon>
                                                                                        <span>{{'labelMore'| translate}}</span>
                                                                                    </label>
                                                                                </div>
                                                                            </div>
                                                                            
                                                                        </div>
                                            
                                                                        <!-- color picker body End-->
                                                                    </ng-template>
                                                                    <!-- End  -->
                                                            </mat-form-field>
                                                        </div>
                                                        <div class="buttonGroup">
                                                            <button [disabled]="mode=='R'|| workflowUsed" mat-stroked-button
                                                                color="primary" tabindex id="btnAdd-parent-{{i}}"
                                                                class="remove-row addEsitDeleteButt" type="button"
                                                                (click)="addChildStage(i, parent.get('Stages').controls.length)">
                                                                <mat-icon>add</mat-icon>
                                                            </button>
                                                            <button
                                                                *ngIf="!(mode=='R' || parent.get('StageTypeCode').value==newLead || parent.get('StageTypeCode').value==Closing) &&  !workflowUsed "
                                                                mat-stroked-button color="warn" tabindex type="button"
                                                                id="btnRemove-parent-{{i}}"
                                                                class="remove-row addEsitDeleteButt"
                                                                (click)="confirmDialogParentRow(i,parent.get('IsNew').value)">
                                                                <mat-icon>delete_outline</mat-icon>
                                                            </button>
                                                            <button
                                                            *ngIf="!(mode=='R' || parent.get('StageTypeCode').value==newLead || parent.get('StageTypeCode').value==Closing) && workflowUsed"
                                                            [disabled]="parent.get('workflowUsed').value"
                                                            mat-stroked-button color="warn" tabindex type="button"
                                                            id="btnRemove-parent1-{{i}}"
                                                            class="remove-row addEsitDeleteButt"
                                                            (click)="confirmDialogParentRow(i,parent.get('IsNew').value)" >
                                                            <mat-icon>delete_outline</mat-icon>
                                                        </button>
                                                        </div>
                                                    </div>
                                                    <div class="checkboxGroupSec">
                                                        <mat-slide-toggle color="primary" class="jobPipeline"
                                                            (change)="changeActiveToggel($event,i,null,null,parent.get('Active').value);changeParentToggel(i,parent.get('Active').value)"
                                                            formControlName="Active" id="Active_{{ i }}" labelPosition="before">
                                                            {{"label_statusActive" |
                                                            translate }}?
                                                        </mat-slide-toggle>
                                                        <mat-slide-toggle color="primary" class="jobPipeline"
                                                            formControlName="JobPipeline" id="JobPipelinep_{{ i }}"
                                                            labelPosition="before">
                                                            {{"label_leadPipline" | customTranslate }}
                                                        </mat-slide-toggle>
                                                        <!-- <mat-slide-toggle color="primary" disabled class="jobPipeline"
                                                            formControlName="BuiltIn" id="BuiltIn_{{ i }}"
                                                            labelPosition="before">
                                                            {{"label_builtIn" |
                                                            translate }}?
                                                        </mat-slide-toggle>
                                                        <mat-slide-toggle color="primary" class="jobPipeline"
                                                            formControlName="AutomatedActions" id="AutomatedActions_{{ i }}"
                                                            labelPosition="before">
                                                            {{"label_automatedActions" |translate }}?
                                                        </mat-slide-toggle> -->
                                                        
                                                        <div class="stagetype-box">
                                                            <mat-slide-toggle color="primary" class="stageType" 
                                                                [disabled]="parent.get('StageTypeCode').value==newLead || parent.get('StageTypeCode').value==Closing"
                                                                formControlName="IsStageType" id="stageType_{{ i }}"
                                                                labelPosition="before"
                                                                (change)="onSlideStage($event.checked,i,'Add',parent.get('StageTypeCode').value)">
                                                                {{"label_StageType" | translate }} <span  [ngClass]="{'red-color': parent.get('StageTypeCode').value=='' || parent.get('StageTypeCode').value==null || parent.get('StageTypeCode').value==undefined}">*</span>
                                                                <div [matMenuTriggerFor]="stageType"
                                                                    #stageTypeTrigger="matMenuTrigger"></div>
                                                            </mat-slide-toggle>
                                                            <ng-container *ngIf="parent.get('StageTypeCode').value">
                                                                <div class="stage-type-value">
                                                                     <!-------@suika @EWM-10500 stage color code display @whn 17-03-2023-->
                                                                    <span>
                                                                        {{parent.get('StageTypeCode').value}}
                                                                        <span
                                                                            *ngIf="parent.get('StageTypeCode').value==newLead">-First
                                                                            stage</span>
                                                                        <span
                                                                            *ngIf="parent.get('StageTypeCode').value==Closing">-Last
                                                                            stage</span>
                                                                    </span>
    
                                                                    <span [style.background-color]="parent.get('StageTypeColorCode').value" class="stageColor"> </span> 
                                                                    <button *ngIf="parent.get('StageTypeCode').value!==newLead && parent.get('StageTypeCode').value!==Closing"
                                                                    mat-mini-fab class="addTag" id="editStageType{{i}}" color="primary"
                                                                        (click)="onSlideStage($event.checked,i,'Edit',parent.get('StageTypeCode').value)"
                                                                        type="button" matTooltipClass="custom-tooltip"
                                                                        matTooltip="{{'label_edit'|translate}}">
                                                                        <mat-icon>edit</mat-icon>
                                                                    </button>
                                                                </div>
                                                            </ng-container>
                                                        </div>
                                                        <mat-menu #stageType="matMenu" class="define-stage-type"
                                                            [overlapTrigger]="false" backdropClass="aaaaaaaaaaaaaaaaaa" [hasBackdrop]="false">
                                                            <div (click)="$event.stopPropagation();" class="dropdown-header">
                                                                <!--@When: 18-04-2023 @who:Amit @why: EWM-16723 @what: label change-->
                                                                <mat-card-subtitle *ngIf="disabledSaveBtn==true" class="show-stage-type">{{'label_jobWorkflow_showStageTypeTitle'|translate}}
                                                                </mat-card-subtitle>
                                                                <mat-card-title>{{'label_defineStageType'|translate}}
                                                                </mat-card-title>
                                                                <mat-card-subtitle>{{'label_singleSelect'|translate}}
                                                                </mat-card-subtitle>
                                                            </div>
                                                            <form [formGroup]="stageForm" id="stageForm">
                                                                <div class="pl-15 pr-15 mt-5 mb-5" (click)="$event.stopPropagation();">
                                                                    <mat-form-field floatLabel="never">
                                                                        <input matInput type="text" id="candidate-tagSearch"
                                                                            [(ngModel)]="searchTextTag" name="searchTextEWM"
                                                                            placeholder="{{'label_jobWorkflow_searchApplicationstages'|translate}}"
                                                                            [ngModelOptions]="{standalone: true}" />
                                                                        <mat-icon matPrefix>search</mat-icon>
                                                                        <button *ngIf="searchTextTag" matSuffix mat-icon-button
                                                                            aria-label="Clear" (click)="searchTextTag=''">
                                                                            <mat-icon>close</mat-icon>
                                                                        </button>
                                                                    </mat-form-field>
                                                                </div>
                                                                <div class="blank-height10" (click)="$event.stopPropagation();">
                                                                </div>
                                                                <div class="define-stage-togglelist smallSlideToggle"
                                                                    (click)="$event.stopPropagation();" [ngClass]="disabledSaveBtn==true? 'stage-alert' : ''"
                                                                    formArrayName="stageInfo">
                                                                    <div class="tagList mat-menu-item"
                                                                        *ngFor="let tag of stageInfo().controls |formgroupFilter:searchTextTag:'Code' ;let l=index"
                                                                        [formGroupName]="l"
                                                                        matTooltip=" {{tag.controls['Code'].value}}"
                                                                        matTooltipClass="custom-tooltip">
                                                                        
                                                                        <mat-slide-toggle labelPosition="before"
                                                                            [disabled]="(tag.controls['Code'].value==newLead || tag.controls['Code'].value==Closing)?true:false"
                                                                            (change)="selectStageList($event,l,tag.controls['Code'].value,tag)"
                                                                            formControlName="stageCheck"
                                                                            class="mat-slide-toggle pr-0"
                                                                            id="{{tag.controls['Id'].value}}"
                                                                            [checked]="tag.controls['Id'].value===selectedStage[tag.controls['Id'].value]?true:false"
                                                                            color="primary">
                                                                            {{tag.controls['Code'].value}}
                                                                        </mat-slide-toggle>
                                                                    </div>
                                                                </div>
                                                                <div class="blank-height10" (click)="$event.stopPropagation();">
                                                                </div>
                                                                <div class="mat-menu-footer">
                                                                    <!--@When: 08-04-2023 @who:Amit @why: EWM-16609 @what: btn changes-->
                                                                    <button mat-stroked-button color="warn" tabindex
                                                                        id="btnCancelStage" (click)="onCancel(i);">
                                                                        <!-- <mat-icon>close</mat-icon> -->
                                                                        <span class="buttonTxt">{{ "label_cancel" | translate
                                                                            }}</span>
                                                                    </button>
                                                                    <button mat-stroked-button tabindex color="primary"
                                                                        type="button" (click)="onSaveStage();"
                                                                        id="btnSaveStage{{i}}" [disabled]="!stageForm.valid || disabledSaveBtn">
                                                                        <!-- <mat-icon>check</mat-icon> -->
                                                                        <span class="buttonTxt">{{ "label_save" | translate
                                                                            }}</span>
                                                                    </button>
                                                                </div>
                                                            </form>
                                                        </mat-menu>
                                                     
                                                    </div>
                                                </div>
                                            </mat-card>
                                        </div>
                                        <mat-card class="expandCollapseContent firstStep">
                                            <button type="button" class="drag-handle" [disabled]="parent.get('StageTypeCode').value==newLead || parent.get('StageTypeCode').value==Closing" mat-raised-button color="primary" cdkDragHandle>
                                                <mat-icon>drag_indicator</mat-icon>
                                            </button>
                                            <div class="all-control">
                                                <div class="flex-row">
                                                    <div class="form-controls">
                                                        <div class="toggleButtonBox">
                                                            <button mat-icon-button class="drag-handle toggleButton"
                                                                type="button"
                                                                *ngIf="parent.get('Stages').controls.length>0"
                                                                (click)="toggleParent(i)"
                                                                [ngClass]="hideChildContent[i] ? 'unfold' : 'fold'">
                                                                <mat-icon>keyboard_arrow_up</mat-icon>
                                                            </button>
                                                        </div>
                                                        <mat-form-field class="stageName mb-0" floatLabel="always">
                                                            <mat-label>{{ "label_stageName" | translate }} </mat-label>
                                                            <input type="hidden" formControlName="StageId"
                                                                id="StageId_{{i}}">
                                                            <input type="hidden" formControlName="InternalCode"
                                                                id="InternalCodes_{{i}}">
                                                            <input type="hidden" formControlName="ParentStageId"
                                                                id="ParentStageId_{{i}}">
                                                            <input type="hidden" formControlName="IsDeleted"
                                                                id="IsDeleted_{{i}}">
                                                            <input type="hidden" formControlName="WorkflowInternalCode"
                                                                id="WorkflowInternalCode_{{i}}">
                                                            <input type="hidden" formControlName="IsNew"
                                                                id="IsNew_{{i}}">
                                                            <input formControlName="StageName" tabindex
                                                                (blur)="stageExists($event,parent.get('InternalCode').value,parent.get('ParentStageId').value,parent)"
                                                                name="pStageName" matInput id="stageName_{{ i }}"
                                                                placeholder="{{ 'label_stageName' | translate }}"
                                                                required />
                                                            <mat-error
                                                                *ngIf="parent.get('StageName').errors?.required && parent.get('StageName').touched">
                                                                {{ 'label_stageName' |translate}} {{
                                                                'label_errorreqired'
                                                                |translate}}
                                                            </mat-error>
                                                            <mat-error
                                                                *ngIf="parent.get('StageName').errors?.maxlength && parent.get('StageName').touched">
                                                                {{ 'label_stageName' |translate}} {{
                                                                'label_errormaxlength50'
                                                                |translate}}
                                                            </mat-error>
                                                            <mat-error
                                                                *ngIf="parent.get('StageName').errors?.unique && parent.get('StageName').touched">
                                                                {{ 'label_stageName' |translate}} {{ 'label_errorunique'
                                                                |translate}}
                                                            </mat-error>
                                                            <mat-error
                                                                *ngIf="parent.get('StageName').hasError('stageTaken')">
                                                                {{'label_stageName'|translate}}
                                                                {{'label_errorreqiredAlready'|translate}}
                                                            </mat-error>
                                                        </mat-form-field>
                                                        <mat-form-field class="stageTextarea mb-0" floatLabel="always">
                                                            <mat-label>{{ "label_stageDesc" | translate }}</mat-label>
                                                            <textarea matInput tabindex formControlName="StageDesc"
                                                                class="textareaHeight" id="StageDescp_{{ i }}"
                                                                placeholder="{{ 'label_stageDesc' | translate }}"></textarea>
                                    
                                                            <mat-error
                                                                *ngIf="parent.get('StageDesc').errors?.maxlength && parent.get('StageDesc').touched">
                                                                {{ 'label_stageDesc' |translate}} {{
                                                                'label_errormaxlength100'
                                                                |translate}}
                                                            </mat-error>
                                                        </mat-form-field>
                                                        <mat-form-field class="mb-0 colorCode" floatLabel="always">
                                                            <mat-label>{{ "label_colorCode" |
                                                                translate }}</mat-label>
                                                                <input matInput formControlName="ColorCode" id="ColorCode_{{i}}" readonly>
        <!-- /*--@Who:Bantee,@When: 28-09-2023,@Why:EWM-12471,@What:When user swaps any two job workflow stage, color code of those stage is not swapped.-----*/ -->
    
                                                                <div matSuffix class="color-picker-button" [ngStyle]="{backgroundColor:parent.get('ColorCode').value}" (click)="showColorPallate($event,'parent',i,null,null)" cdkOverlayOrigin #trigger="cdkOverlayOrigin">
                                                                </div>
                                                                <!-- --------@When: 14-03-2023 @who:Renu @why: EWM-10634 ewm-11123 Desc- Custome color picker -------- -->
                                                                <ng-template cdkConnectedOverlay cdkConnectedOverlayBackdropClass="cdk-overlay-transparent-backdrop"
                                                                [cdkConnectedOverlayHasBackdrop]="true" [cdkConnectedOverlayOrigin]="trigger" [cdkConnectedOverlayOpen]="showColorPallateContainer[i]"
                                                                (backdropClick)="showColorPallateContainer[i] = false">
                                                                    <!-- color picker body  -->
                                                                    <div class="color-picker-default">
                                                                        <input type="color" id="head" name="head"  (input)="onChaneColor($event,'parent',i,null,null)">
                                                                    </div>
                                                                    <div class="color-picker-container" [style.opacity]="isMoreColorClicked ? '0' : ' '"
                                                                        [style.display]="isMoreColorClicked ? 'none' : ' '">
                                                                        <div class="themeColor">{{'label_selectColour' | translate}}</div>
                                                                        <div class="picker theme-color">
                                                                            <div (click)="onSelectColor(codes,'parent',i,null,null)" class="color-picker" *ngFor="let codes of themeColors"
                                                                                [ngStyle]="{backgroundColor:codes.colorCode}"> </div>
                                                                        </div>
                                                                        <div class="picker standard-color">
                                                                            <div (click)="onSelectColor(codes,'parent',i,null,null)" class="color-picker" *ngFor="let codes of standardColor"
                                                                                [ngStyle]="{backgroundColor:codes.colorCode}">
                                                                            </div>
                                                                        </div>
                                                                        
                                                                        <div class="footer">
                                                                            <div class="noFill" (click)="onSelectColor(null,'parent',i,null,null)">
                                                                                <mat-icon>clear</mat-icon>
                                                                                <div class="noFillText">{{'label_clear'| translate}}</div>
                                                                            </div>
                                                                            <div class="more" (click)="closeTemplate()">
                                                                                <label for="head" class="noFill">
                                                                                    <mat-icon fontSet="material-icons-outlined">palette</mat-icon>
                                                                                    <span>{{'labelMore'| translate}}</span>
                                                                                </label>
                                                                            </div>
                                                                        </div>
                                                                        
                                                                    </div>
                                        
                                                                    <!-- color picker body End-->
                                                                </ng-template>
                                                                <!-- End  -->
                                                        </mat-form-field>
                                                    </div>
                                                    <div class="buttonGroup">
                                                        <button [disabled]="mode=='R'|| workflowUsed" mat-stroked-button
                                                            color="primary" tabindex id="btnAdd-parent-{{i}}"
                                                            class="remove-row addEsitDeleteButt" type="button"
                                                            (click)="addChildStage(i, parent.get('Stages').controls.length)">
                                                            <mat-icon>add</mat-icon>
                                                        </button>
                                                        <button
                                                            *ngIf="!(mode=='R' || parent.get('StageTypeCode').value==newLead || parent.get('StageTypeCode').value==Closing) &&  !workflowUsed "
                                                            mat-stroked-button color="warn" tabindex type="button"
                                                            id="btnRemove-parent-{{i}}"
                                                            class="remove-row addEsitDeleteButt"
                                                            (click)="confirmDialogParentRow(i,parent.get('IsNew').value)">
                                                            <mat-icon>delete_outline</mat-icon>
                                                        </button>
                                                        <button
                                                        *ngIf="!(mode=='R' || parent.get('StageTypeCode').value==newLead || parent.get('StageTypeCode').value==Closing) && workflowUsed"
                                                        [disabled]="parent.get('workflowUsed').value"
                                                        mat-stroked-button color="warn" tabindex type="button"
                                                        id="btnRemove-parent1-{{i}}"
                                                        class="remove-row addEsitDeleteButt"
                                                        (click)="confirmDialogParentRow(i,parent.get('IsNew').value)" >
                                                        <mat-icon>delete_outline</mat-icon>
                                                    </button>
                                                    </div>
                                                </div>
                                                <div class="checkboxGroupSec">
                                                    <mat-slide-toggle color="primary" class="jobPipeline"
                                                        (change)="changeActiveToggel($event,i,null,null,parent.get('Active').value);changeParentToggel(i,parent.get('Active').value)"
                                                        formControlName="Active" id="Active_{{ i }}" labelPosition="before">
                                                        {{"label_statusActive" |
                                                        translate }}?
                                                    </mat-slide-toggle>
                                                    <mat-slide-toggle color="primary" class="jobPipeline"
                                                        formControlName="JobPipeline" id="JobPipelinep_{{ i }}"
                                                        labelPosition="before">
                                                        {{"label_leadPipline" | customTranslate }}
                                                    </mat-slide-toggle>
                                                    <!-- <mat-slide-toggle color="primary" disabled class="jobPipeline"
                                                        formControlName="BuiltIn" id="BuiltIn_{{ i }}"
                                                        labelPosition="before">
                                                        {{"label_builtIn" |
                                                        translate }}?
                                                    </mat-slide-toggle>
                                                    <mat-slide-toggle color="primary" class="jobPipeline"
                                                        formControlName="AutomatedActions" id="AutomatedActions_{{ i }}"
                                                        labelPosition="before">
                                                        {{"label_automatedActions" |translate }}?
                                                    </mat-slide-toggle>
                                                    -->
                                                    <div class="stagetype-box">
                                                        <mat-slide-toggle color="primary" class="stageType" 
                                                            [disabled]="parent.get('StageTypeCode').value==newLead || parent.get('StageTypeCode').value==Closing"
                                                            formControlName="IsStageType" id="stageType_{{ i }}"
                                                            labelPosition="before"
                                                            (change)="onSlideStage($event.checked,i,'Add',parent.get('StageTypeCode').value)">
                                                            {{"label_StageType" | translate }} <span class="required-show"  [ngClass]="{'red-color': parent.get('StageTypeCode').value=='' || parent.get('StageTypeCode').value==null || parent.get('StageTypeCode').value==undefined}">*</span>
                                                            <div [matMenuTriggerFor]="stageType"
                                                                #stageTypeTrigger="matMenuTrigger"></div>
                                                        </mat-slide-toggle>
                                                        <ng-container *ngIf="parent.get('StageTypeCode').value">
                                                            <div class="stage-type-value">
                                                                 <!-------@suika @EWM-10500 stage color code display @whn 17-03-2023-->
                                                                <span>
                                                                    {{parent.get('StageTypeCode').value}}
                                                                    <span
                                                                        *ngIf="parent.get('StageTypeCode').value==newLead">-First
                                                                        stage</span>
                                                                    <span
                                                                        *ngIf="parent.get('StageTypeCode').value==Closing">-Last
                                                                        stage</span>
                                                                </span>
    
                                                                <span [style.background-color]="parent.get('StageTypeColorCode').value" class="stageColor"> </span> 
                                                                <button *ngIf="parent.get('StageTypeCode').value!==newLead && parent.get('StageTypeCode').value!==Closing"
                                                                mat-mini-fab class="addTag" id="editStageType{{i}}" color="primary"
                                                                    (click)="onSlideStage($event.checked,i,'Edit',parent.get('StageTypeCode').value)"
                                                                    type="button" matTooltipClass="custom-tooltip"
                                                                    matTooltip="{{'label_edit'|translate}}">
                                                                    <mat-icon>edit</mat-icon>
                                                                </button>
                                                            </div>
                                                        </ng-container>
                                                    </div>
                                                    <mat-menu #stageType="matMenu" class="define-stage-type"
                                                        [overlapTrigger]="false" backdropClass="aaaaaaaaaaaaaaaaaa" [hasBackdrop]="false">
                                                        <div (click)="$event.stopPropagation();" class="dropdown-header">
                                                            <!--@When: 18-04-2023 @who:Amit @why: EWM-16723 @what: label change-->
                                                            <mat-card-subtitle *ngIf="disabledSaveBtn==true" class="show-stage-type">{{'label_jobWorkflow_showStageTypeTitle'|translate}}
                                                            </mat-card-subtitle>
                                                            <mat-card-title>{{'label_defineStageType'|translate}}
                                                            </mat-card-title>
                                                            <mat-card-subtitle>{{'label_singleSelect'|translate}}
                                                            </mat-card-subtitle>
                                                        </div>
                                                        <form [formGroup]="stageForm" id="stageForm">
                                                            <div class="pl-15 pr-15 mt-5 mb-5" (click)="$event.stopPropagation();">
                                                                <mat-form-field floatLabel="never">
                                                                    <input matInput type="text" id="candidate-tagSearch"
                                                                        [(ngModel)]="searchTextTag" name="searchTextEWM"
                                                                        placeholder="{{'label_jobWorkflow_searchApplicationstages'|translate}}"
                                                                        [ngModelOptions]="{standalone: true}" />
                                                                    <mat-icon matPrefix>search</mat-icon>
                                                                    <button *ngIf="searchTextTag" matSuffix mat-icon-button
                                                                        aria-label="Clear" (click)="searchTextTag=''">
                                                                        <mat-icon>close</mat-icon>
                                                                    </button>
                                                                </mat-form-field>
                                                            </div>
                                                            <div class="blank-height10" (click)="$event.stopPropagation();">
                                                            </div>
                                                            <div class="define-stage-togglelist smallSlideToggle"
                                                                (click)="$event.stopPropagation();" [ngClass]="disabledSaveBtn==true? 'stage-alert' : ''"
                                                                formArrayName="stageInfo">
                                                                <div class="tagList mat-menu-item"
                                                                    *ngFor="let tag of stageInfo().controls |formgroupFilter:searchTextTag:'Code' ;let l=index"
                                                                    [formGroupName]="l"
                                                                    matTooltip=" {{tag.controls['Code'].value}}"
                                                                    matTooltipClass="custom-tooltip">
                                                                    
                                                                    <mat-slide-toggle labelPosition="before"
                                                                        [disabled]="(tag.controls['Code'].value==newLead || tag.controls['Code'].value==Closing)?true:false"
                                                                        (change)="selectStageList($event,l,tag.controls['Code'].value,tag)"
                                                                        formControlName="stageCheck"
                                                                        class="mat-slide-toggle pr-0"
                                                                        id="{{tag.controls['Id'].value}}"
                                                                        [checked]="tag.controls['Id'].value===selectedStage[tag.controls['Id'].value]?true:false"
                                                                        color="primary">
                                                                        {{tag.controls['Code'].value}}
                                                                    </mat-slide-toggle>
                                                                </div>
                                                            </div>
                                                            <div class="blank-height10" (click)="$event.stopPropagation();">
                                                            </div>
                                                            <div class="mat-menu-footer">
                                                                <!--@When: 08-04-2023 @who:Amit @why: EWM-16609 @what: btn changes-->
                                                                <button mat-stroked-button color="warn" tabindex
                                                                    id="btnCancelStage" (click)="onCancel(i);">
                                                                    <!-- <mat-icon>close</mat-icon> -->
                                                                    <span class="buttonTxt">{{ "label_cancel" | translate
                                                                        }}</span>
                                                                </button>
                                                                <button mat-stroked-button tabindex color="primary"
                                                                    type="button" (click)="onSaveStage();"
                                                                    id="btnSaveStage{{i}}" [disabled]="!stageForm.valid || disabledSaveBtn">
                                                                    <!-- <mat-icon>check</mat-icon> -->
                                                                    <span class="buttonTxt">{{ "label_save" | translate
                                                                        }}</span>
                                                                </button>
                                                            </div>
                                                        </form>
                                                    </mat-menu>
                                                    <!-----stage type end-->
                                               
                                                </div>
                                            </div>
                                        </mat-card>
                                        <div cdkDropList (cdkDropListDropped)="dropChild($event,i)"
                                            class="childAnimation-{{i}}  animate__faster"
                                            [ngClass]="!hideChildContent[i] ? 'animate__slideInDown' : 'animate__slideOutUp'">
                                            <ng-container formArrayName="Stages" *ngIf="!hideChildContent[i]">
                                                <div *ngFor="let children of parent.get('Stages').controls;let j = index"
                                                    [formGroupName]="j" cdkDrag id="addChild{{i}}{{j+1}}" [cdkDragDisabled]="workflowUsed"
                                                    [ngClass]="userAnimationStatus?'animate__animated':''"
                                                    class="firstChild deleteChild-{{i}}{{j}}">
                                                    <div class="child-placeholder" *cdkDragPlaceholder></div>
                                                    <div *cdkDragPreview class="child-preview">
                                                        <mat-card class="expandCollapseContent secStep" [ngClass]="workflowUsed?'firstStep':''">
                                                            <button type="button" class="drag-handle" mat-raised-button cdkDragHandle>
                                                                <mat-icon>drag_indicator</mat-icon>
                                                            </button>
                                                            <div class="all-control">
                                                                <div class="flex-row">
                                                                    <div class="form-controls">
                                                                        <div class="toggleButtonBox">
                                                                            <button type="button" tabindex mat-icon-button
                                                                                class="drag-handle toggleButton"
                                                                                *ngIf="children.get('Stages').controls.length>0"
                                                                                (click)="toggleChild(i,j)"
                                                                                [ngClass]="hideSubChildContent[i+'.'+j] ? 'unfold' : 'fold'">
                                                                                <mat-icon>keyboard_arrow_up</mat-icon>
                                                                            </button>
                                                                        </div>
                                                                        <mat-form-field class="stageName mb-0"
                                                                            floatLabel="always">
                                                                            <mat-label>{{ "label_stageName" | translate }}
                                                                            </mat-label>
                                                                            <input type="hidden" formControlName="StageId"
                                                                                id="StageId_{{i}}{{j}}">
                                                                            <input type="hidden"
                                                                                formControlName="InternalCode"
                                                                                id="InternalCodes_{{i}}{{j}}">
        
                                                                            <input type="hidden"
                                                                                formControlName="ParentStageId"
                                                                                id="ParentStageId_{{i}}{{j}}">
                                                                            <input type="hidden" formControlName="IsNew"
                                                                                id="IsNew_{{i}}{{j}}">
        
                                                                            <input tabindex formControlName="StageName"
                                                                                name="pStageName" matInput
                                                                                id="stageNamec_{{ i }}{{j}}"
                                                                                (blur)="stageExists($event,children.get('InternalCode').value,children.get('ParentStageId').value,children)"
                                                                                placeholder="{{ 'label_stageName' | translate }}"
                                                                                required />
                                                                            <mat-error
                                                                                *ngIf="children.get('StageName').errors?.required && children.get('StageName').touched">
                                                                                {{ 'label_stageName' |translate}} {{
                                                                                'label_errorreqired' |translate}}
                                                                            </mat-error>
                                                                            <mat-error
                                                                                *ngIf="children.get('StageName').errors?.maxlength && children.get('StageName').touched">
                                                                                {{ 'label_stageName' |translate}} {{
                                                                                'label_errormaxlength50' |translate}}
                                                                            </mat-error>
                                                                            <mat-error
                                                                                *ngIf="children.get('StageName').errors?.unique && children.get('StageName').touched">
                                                                                {{ 'label_stageName' |translate}} {{
                                                                                'label_errorunique'
                                                                                |translate}}
                                                                            </mat-error>
                                                                            <mat-error
                                                                                *ngIf="children.get('StageName').hasError('stageTaken')">
                                                                                {{'label_stageName'|translate}}
                                                                                {{'label_errorreqiredAlready'|translate}}
                                                                            </mat-error>
                                                                        </mat-form-field>
                                                                        <mat-form-field class="stageTextarea mb-0"
                                                                            floatLabel="always">
                                                                            <mat-label>{{ "label_stageDesc" | translate }}
                                                                            </mat-label>
        
                                                                            <textarea matInput tabindex
                                                                                formControlName="StageDesc"
                                                                                id="StageDescc_{{i}}{{ j }}"
                                                                                class="textareaHeight"
                                                                                placeholder="{{ 'label_stageDesc' | translate }}"></textarea>
                                                                            
                                                                            <mat-error
                                                                                *ngIf="children.get('StageDesc').errors?.maxlength && children.get('StageDesc').touched">
                                                                                {{ 'label_stageDesc' |translate}} {{
                                                                                'label_errormaxlength100' |translate}}
                                                                            </mat-error>
                                                                        </mat-form-field>
                                                                        <mat-form-field class="mb-0 colorCode"
                                                                            floatLabel="always">
                                                                            <mat-label>{{ "label_colorCode" |
                                                                                translate }}</mat-label>
                                                                            <input matInput formControlName="ColorCode" id="ColorCodesc_{{i}}{{ j }}" readonly>
            <!-- /*--@Who:Bantee,@When: 28-09-2023,@Why:EWM-12471,@What:When user swaps any two job workflow stage, color code of those stage is not swapped.-----*/ -->
        
                                                                    <div matSuffix class="color-picker-button" [ngStyle]="{backgroundColor:children.get('ColorCode').value}" (click)="showColorPallate($event,'child',i,j,null)" cdkOverlayOrigin #trigger="cdkOverlayOrigin">
                                                                    </div>
                                                                    <!-- --------@When: 14-03-2023 @who:Renu @why: EWM-10634 ewm-11123 Desc- Custome color picker -------- -->
                                                                    <ng-template cdkConnectedOverlay cdkConnectedOverlayBackdropClass="cdk-overlay-transparent-backdrop"
                                                                    [cdkConnectedOverlayHasBackdrop]="true" [cdkConnectedOverlayOrigin]="trigger" [cdkConnectedOverlayOpen]="showColorPallateContainerChild[i+'_'+j]"
                                                                    (backdropClick)="showColorPallateContainerChild[i+'_'+j] = false">
                                                                        <!-- color picker body  -->
                                                                        <div class="color-picker-default">
                                                                            <input type="color" id="head" name="head"  (input)="onChaneColor($event,'child',i,j,null)">
                                                                        </div>
                                                                        <div class="color-picker-container" [style.opacity]="isMoreColorClicked ? '0' : ' '"
                                                                            [style.display]="isMoreColorClicked ? 'none' : ' '">
                                                                            <div class="themeColor">{{'label_selectColour' | translate}}</div>
                                                                            <div class="picker theme-color">
                                                                                <div (click)="onSelectColor(codes,'child',i,j,null)" class="color-picker" *ngFor="let codes of themeColors"
                                                                                    [ngStyle]="{backgroundColor:codes.colorCode}"> </div>
                                                                            </div>
                                                                            <div class="picker standard-color">
                                                                                <div (click)="onSelectColor(codes,'child',i,j,null)" class="color-picker" *ngFor="let codes of standardColor"
                                                                                    [ngStyle]="{backgroundColor:codes.colorCode}">
                                                                                </div>
                                                                            </div>
                                                                            
                                                                            <div class="footer">
                                                                                <div class="noFill" (click)="onSelectColor(null,'child',i,j,null)">
                                                                                    <mat-icon>clear</mat-icon>
                                                                                    <div class="noFillText">{{'label_clear'| translate}}</div>
                                                                                </div>
                                                                                <div class="more" (click)="closeTemplate()">
                                                                                    <label for="head" class="noFill">
                                                                                        <mat-icon fontSet="material-icons-outlined">palette</mat-icon>
                                                                                        <span>{{'labelMore'| translate}}</span>
                                                                                    </label>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                        <!-- color picker body End-->
                                                                    </ng-template>
                                                                        </mat-form-field>
                                                                    </div>
                                                                    <div class="buttonGroup">
                                                                        <button [disabled]="mode=='R' || workflowUsed" mat-stroked-button
                                                                            tabindex color="primary" type="button"
                                                                            id="btnAdd-child-{{i}}{{ j }}"
                                                                            class="remove-row addEsitDeleteButt"
                                                                            (click)="addSubChildStage(i, j, children.get('Stages').controls.length)">
                                                                            <mat-icon>add</mat-icon>
                                                                        </button>
                                                                        <button [disabled]="mode=='R'  || workflowUsed" mat-stroked-button
                                                                            tabindex color="warn" type="button"
                                                                            id="btnRemove-child-{{i}}{{ j }}"
                                                                            class="remove-row addEsitDeleteButt"
                                                                            (click)="confirmDialogChildRow(i, j,children.get('IsNew').value)">
                                                                            <mat-icon>delete_outline</mat-icon>
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                                <div class="checkboxGroupSec">
                                                                    <mat-slide-toggle color="primary" class="jobPipeline"
                                                                        formControlName="Active" id="Activec_{{ i }}{{ j }}"
                                                                        (change)="changeActiveToggel($event,i,j,null,children.get('Active').value);changeChildToggel(i,j,children.get('Active').value)"
                                                                        labelPosition="before">
                                                                        {{"label_statusActive" | translate }}?
                                                                    </mat-slide-toggle>
                                                                    <mat-slide-toggle color="primary" class="jobPipeline"
                                                                        formControlName="JobPipeline"
                                                                        id="JobPipelinec_{{ i }}{{ j }}" labelPosition="before">
                                                                        {{"label_leadPipline" | customTranslate }}</mat-slide-toggle>
    
                                                                    <!-- <mat-slide-toggle color="primary" class="jobPipeline"
                                                                        formControlName="BuiltIn" id="BuiltInc_{{ i }}{{ j }}"
                                                                        labelPosition="before" disabled>
                                                                        {{"label_builtIn" | translate }}?</mat-slide-toggle>
                                                                    <mat-slide-toggle color="primary" class="jobPipeline"
                                                                        formControlName="AutomatedActions"
                                                                        id="AutomatedActions_{{ i }}{{ j }}"
                                                                        labelPosition="before">
                                                                        {{"label_automatedActions" |translate }}?
                                                                    </mat-slide-toggle>
                                                                     -->
                                                                  
                                                               
                                                                    <!-- map workflow features End -->
                                                                    <!-- @Who: Adarsh singh @When: 29-12-2022 @Why: ROST-9390.EWM-10074 END -->
                                                                    <div class="stagetype-box">
                                                                        <ng-container *ngIf="parent.get('StageTypeCode').value">
                                                                            <div class="stage-type-value">
                                                                                <strong>{{"label_StageType" | translate
                                                                                    }}:</strong>
                                                                                        <!-------@suika @EWM-10500 stage color code display @whn 17-03-2023-->
                                                                                <span>
                                                                                    {{parent.get('StageTypeCode').value}} 
                                                                                    <span
                                                                                        *ngIf="parent.get('StageTypeCode').value==newLead">-First
                                                                                        stage</span>
                                                                                    <span
                                                                                        *ngIf="parent.get('StageTypeCode').value==Closing">-Last
                                                                                        stage</span>
                                                                                </span>
        
                                                                                <span
                                                                                    [style.background-color]="parent.get('StageTypeColorCode').value"
                                                                                    class="stageColor"> </span>
        
                                                                            </div>
                                                                        </ng-container>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </mat-card>
                                                    </div>
                                                    <mat-card class="expandCollapseContent secStep" [ngClass]="workflowUsed?'firstStep':''">
                                                        <button type="button" class="drag-handle" mat-raised-button cdkDragHandle>
                                                            <mat-icon>drag_indicator</mat-icon>
                                                        </button>
                                                        <div class="all-control">
                                                            <div class="flex-row">
                                                                <div class="form-controls">
                                                                    <div class="toggleButtonBox">
                                                                        <button type="button" tabindex mat-icon-button
                                                                            class="drag-handle toggleButton"
                                                                            *ngIf="children.get('Stages').controls.length>0"
                                                                            (click)="toggleChild(i,j)"
                                                                            [ngClass]="hideSubChildContent[i+'.'+j] ? 'unfold' : 'fold'">
                                                                            <mat-icon>keyboard_arrow_up</mat-icon>
                                                                        </button>
                                                                    </div>
                                                                    <mat-form-field class="stageName mb-0"
                                                                        floatLabel="always">
                                                                        <mat-label>{{ "label_stageName" | translate }}
                                                                        </mat-label>
                                                                        <input type="hidden" formControlName="StageId"
                                                                            id="StageId_{{i}}{{j}}">
                                                                        <input type="hidden"
                                                                            formControlName="InternalCode"
                                                                            id="InternalCodes_{{i}}{{j}}">
    
                                                                        <input type="hidden"
                                                                            formControlName="ParentStageId"
                                                                            id="ParentStageId_{{i}}{{j}}">
                                                                        <input type="hidden" formControlName="IsNew"
                                                                            id="IsNew_{{i}}{{j}}">
    
                                                                        <input tabindex formControlName="StageName"
                                                                            name="pStageName" matInput
                                                                            id="stageNamec_{{ i }}{{j}}"
                                                                            (blur)="stageExists($event,children.get('InternalCode').value,children.get('ParentStageId').value,children)"
                                                                            placeholder="{{ 'label_stageName' | translate }}"
                                                                            required />
                                                                        <mat-error
                                                                            *ngIf="children.get('StageName').errors?.required && children.get('StageName').touched">
                                                                            {{ 'label_stageName' |translate}} {{
                                                                            'label_errorreqired' |translate}}
                                                                        </mat-error>
                                                                        <mat-error
                                                                            *ngIf="children.get('StageName').errors?.maxlength && children.get('StageName').touched">
                                                                            {{ 'label_stageName' |translate}} {{
                                                                            'label_errormaxlength50' |translate}}
                                                                        </mat-error>
                                                                        <mat-error
                                                                            *ngIf="children.get('StageName').errors?.unique && children.get('StageName').touched">
                                                                            {{ 'label_stageName' |translate}} {{
                                                                            'label_errorunique'
                                                                            |translate}}
                                                                        </mat-error>
                                                                        <mat-error
                                                                            *ngIf="children.get('StageName').hasError('stageTaken')">
                                                                            {{'label_stageName'|translate}}
                                                                            {{'label_errorreqiredAlready'|translate}}
                                                                        </mat-error>
                                                                    </mat-form-field>
                                                                    <mat-form-field class="stageTextarea mb-0"
                                                                        floatLabel="always">
                                                                        <mat-label>{{ "label_stageDesc" | translate }}
                                                                        </mat-label>
    
                                                                        <textarea matInput tabindex
                                                                            formControlName="StageDesc"
                                                                            id="StageDescc_{{i}}{{ j }}"
                                                                            class="textareaHeight"
                                                                            placeholder="{{ 'label_stageDesc' | translate }}"></textarea>
                                                                        
                                                                        <mat-error
                                                                            *ngIf="children.get('StageDesc').errors?.maxlength && children.get('StageDesc').touched">
                                                                            {{ 'label_stageDesc' |translate}} {{
                                                                            'label_errormaxlength100' |translate}}
                                                                        </mat-error>
                                                                    </mat-form-field>
                                                                    <mat-form-field class="mb-0 colorCode"
                                                                        floatLabel="always">
                                                                        <mat-label>{{ "label_colorCode" |
                                                                            translate }}</mat-label>
                                                                        <input matInput formControlName="ColorCode" id="ColorCodesc_{{i}}{{ j }}" readonly>
        <!-- /*--@Who:Bantee,@When: 28-09-2023,@Why:EWM-12471,@What:When user swaps any two job workflow stage, color code of those stage is not swapped.-----*/ -->
    
                                                                <div matSuffix class="color-picker-button" [ngStyle]="{backgroundColor:children.get('ColorCode').value}" (click)="showColorPallate($event,'child',i,j,null)" cdkOverlayOrigin #trigger="cdkOverlayOrigin">
                                                                </div>
                                                                <!-- --------@When: 14-03-2023 @who:Renu @why: EWM-10634 ewm-11123 Desc- Custome color picker -------- -->
                                                                <ng-template cdkConnectedOverlay cdkConnectedOverlayBackdropClass="cdk-overlay-transparent-backdrop"
                                                                [cdkConnectedOverlayHasBackdrop]="true" [cdkConnectedOverlayOrigin]="trigger" [cdkConnectedOverlayOpen]="showColorPallateContainerChild[i+'_'+j]"
                                                                (backdropClick)="showColorPallateContainerChild[i+'_'+j] = false">
                                                                    <!-- color picker body  -->
                                                                    <div class="color-picker-default">
                                                                        <input type="color" id="head" name="head"  (input)="onChaneColor($event,'child',i,j,null)">
                                                                    </div>
                                                                    <div class="color-picker-container" [style.opacity]="isMoreColorClicked ? '0' : ' '"
                                                                        [style.display]="isMoreColorClicked ? 'none' : ' '">
                                                                        <div class="themeColor">{{'label_selectColour' | translate}}</div>
                                                                        <div class="picker theme-color">
                                                                            <div (click)="onSelectColor(codes,'child',i,j,null)" class="color-picker" *ngFor="let codes of themeColors"
                                                                                [ngStyle]="{backgroundColor:codes.colorCode}"> </div>
                                                                        </div>
                                                                        <div class="picker standard-color">
                                                                            <div (click)="onSelectColor(codes,'child',i,j,null)" class="color-picker" *ngFor="let codes of standardColor"
                                                                                [ngStyle]="{backgroundColor:codes.colorCode}">
                                                                            </div>
                                                                        </div>
                                                                        
                                                                        <div class="footer">
                                                                            <div class="noFill" (click)="onSelectColor(null,'child',i,j,null)">
                                                                                <mat-icon>clear</mat-icon>
                                                                                <div class="noFillText">{{'label_clear'| translate}}</div>
                                                                            </div>
                                                                            <div class="more" (click)="closeTemplate()">
                                                                                <label for="head" class="noFill">
                                                                                    <mat-icon fontSet="material-icons-outlined">palette</mat-icon>
                                                                                    <span>{{'labelMore'| translate}}</span>
                                                                                </label>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                    <!-- color picker body End-->
                                                                </ng-template>
                                                                    </mat-form-field>
                                                                </div>
                                                                <div class="buttonGroup">
                                                                    <button [disabled]="mode=='R' || workflowUsed" mat-stroked-button
                                                                        tabindex color="primary" type="button"
                                                                        id="btnAdd-child-{{i}}{{ j }}"
                                                                        class="remove-row addEsitDeleteButt"
                                                                        (click)="addSubChildStage(i, j, children.get('Stages').controls.length)">
                                                                        <mat-icon>add</mat-icon>
                                                                    </button>
                                                                    <button [disabled]="mode=='R'  || workflowUsed" mat-stroked-button
                                                                        tabindex color="warn" type="button"
                                                                        id="btnRemove-child-{{i}}{{ j }}"
                                                                        class="remove-row addEsitDeleteButt"
                                                                        (click)="confirmDialogChildRow(i, j,children.get('IsNew').value)">
                                                                        <mat-icon>delete_outline</mat-icon>
                                                                    </button>
                                                                </div>
                                                            </div>
                                                            <div class="checkboxGroupSec">
                                                                <mat-slide-toggle color="primary" class="jobPipeline"
                                                                    formControlName="Active" id="Activec_{{ i }}{{ j }}"
                                                                    (change)="changeActiveToggel($event,i,j,null,children.get('Active').value);changeChildToggel(i,j,children.get('Active').value)"
                                                                    labelPosition="before">
                                                                    {{"label_statusActive" | translate }}?
                                                                </mat-slide-toggle>
                                                                <mat-slide-toggle color="primary" class="jobPipeline"
                                                                    formControlName="JobPipeline"
                                                                    id="JobPipelinec_{{ i }}{{ j }}" labelPosition="before">
                                                                    {{"label_leadPipline" | customTranslate }}</mat-slide-toggle>
    
                                                                <!-- <mat-slide-toggle color="primary" class="jobPipeline"
                                                                    formControlName="BuiltIn" id="BuiltInc_{{ i }}{{ j }}"
                                                                    labelPosition="before" disabled>
                                                                    {{"label_builtIn" | translate }}?</mat-slide-toggle>
                                                                <mat-slide-toggle color="primary" class="jobPipeline"
                                                                    formControlName="AutomatedActions"
                                                                    id="AutomatedActions_{{ i }}{{ j }}"
                                                                    labelPosition="before">
                                                                    {{"label_automatedActions" |translate }}?
                                                                </mat-slide-toggle>
                                                                
                                                            -->
                                                                
                                                                <!-- map workflow features End -->
                                                                <!-- @Who: Adarsh singh @When: 29-12-2022 @Why: ROST-9390.EWM-10074 END -->
                                                                <div class="stagetype-box" *ngIf="parent.get('StageTypeCode').value">
                                                                    <div class="stage-type-value">
                                                                        <strong>{{"label_StageType" | translate
                                                                            }}:</strong>
                                                                                <!-------@suika @EWM-10500 stage color code display @whn 17-03-2023-->
                                                                        <span>
                                                                            {{parent.get('StageTypeCode').value}} 
                                                                            <span
                                                                                *ngIf="parent.get('StageTypeCode').value==newLead">-First
                                                                                stage</span>
                                                                            <span
                                                                                *ngIf="parent.get('StageTypeCode').value==Closing">-Last
                                                                                stage</span>
                                                                        </span>
                                                                        <span
                                                                            [style.background-color]="parent.get('StageTypeColorCode').value"
                                                                            class="stageColor"> </span>
    
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </mat-card>
                                                    <div cdkDropList (cdkDropListDropped)="drop($event,i,j)" 
                                                        class="subChildAnimation-{{i}}{{j}} animate__animated animate__faster"
                                                        [ngClass]="!hideSubChildContent[i+'.'+j] ? 'animate__slideInDown' : 'animate__slideOutUp'">
                                                        <ng-container formArrayName="Stages"
                                                            *ngIf=" !hideSubChildContent[i+'.'+j] ">
                                                            <div *ngFor="let subchild of children.get('Stages').controls;let k = index"
                                                                [formGroupName]="k" cdkDrag [cdkDragDisabled]="workflowUsed"
                                                                id="addSubChild{{i}}{{j}}{{k+1}}"
                                                                [ngClass]="userAnimationStatus?'animate__animated':''"
                                                                class="secondChild  thirdStep  deleteSubChild-{{i}}{{j}}{{k}}">
                                                                <div class="subchild-placeholder" *cdkDragPlaceholder></div>
                                                                <div *cdkDragPreview class="subchild-preview">
                                                                    <mat-card class="expandCollapseContent" [ngClass]="workflowUsed?'firstStep':''">
                                                                        <button type="button" class="drag-handle" mat-raised-button cdkDragHandle>
                                                                            <mat-icon>drag_indicator</mat-icon>
                                                                        </button>
                                                                        <div class="all-control">
                                                                            <div class="flex-row">
                                                                                <div class="form-controls">
                                                                                    <div class="toggleButtonBox"></div>
                                                                                    <mat-form-field class="stageName mb-0"
                                                                                        floatLabel="always">
                                                                                        <mat-label>{{ "label_stageName" |
                                                                                            translate
                                                                                            }}
                                                                                        </mat-label>
                                                                                        <input type="hidden"
                                                                                            formControlName="StageId"
                                                                                            id="StageId_{{i}}{{j}}{{k}}">
                                                                                        <input type="hidden"
                                                                                            formControlName="InternalCode"
                                                                                            id="InternalCodes_{{i}}{{j}}{{k}}">
        
                                                                                        <input type="hidden"
                                                                                            formControlName="ParentStageId"
                                                                                            id="ParentStageId_{{i}}{{j}}{{k}}">
                                                                                        <input type="hidden"
                                                                                            formControlName="IsNew"
                                                                                            id="IsNew_{{i}}{{j}}{{k}}">
        
                                                                                        <input tabindex
                                                                                            formControlName="StageName"
                                                                                            name="pStageName" matInput
                                                                                            (blur)="stageExists($event,subchild.get('InternalCode').value,subchild.get('ParentStageId').value,subchild)"
                                                                                            id="stageNamesc_{{i}}{{ j }}{{ k }}"
                                                                                            placeholder="{{ 'label_stageName' | translate }}"
                                                                                            required />
                                                                                        <mat-error
                                                                                            *ngIf="subchild.get('StageName').errors?.required && subchild.get('StageName').touched">
                                                                                            {{ 'label_stageName'
                                                                                            |translate}} {{
                                                                                            'label_errorreqired'
                                                                                            |translate}}
                                                                                        </mat-error>
                                                                                        
                                                                                        <mat-error
                                                                                            *ngIf="subchild.get('StageName').errors?.maxlength && subchild.get('StageName').touched">
                                                                                            {{ 'label_stageName'
                                                                                            |translate}} {{
                                                                                            'label_errormaxlength50'
                                                                                            |translate}}
                                                                                        </mat-error>
                                                                                        <mat-error
                                                                                            *ngIf="subchild.get('StageName').errors?.unique && subchild.get('StageName').touched">
                                                                                            {{ 'label_stageName'
                                                                                            |translate}} {{
                                                                                            'label_errorunique' |translate}}
                                                                                        </mat-error>
                                                                                        <mat-error
                                                                                            *ngIf="children.get('StageName').hasError('stageTaken')">
                                                                                            {{'label_stageName'|translate}}
                                                                                            {{'label_errorreqiredAlready'|translate}}
                                                                                        </mat-error>
                                                                                    </mat-form-field>
                                                                                    <mat-form-field
                                                                                        class="stageTextarea mb-0"
                                                                                        floatLabel="always">
                                                                                        <mat-label>{{ "label_stageDesc" |
                                                                                            translate
                                                                                            }}
                                                                                        </mat-label>
        
                                                                                        <textarea tabindex matInput
                                                                                            formControlName="StageDesc"
                                                                                            class="textareaHeight"
                                                                                            id="StageDescsc_{{i}}{{ j }}{{ k }}"
                                                                                            placeholder="{{ 'label_stageDesc' | translate }}"></textarea>
                                                                                        
                                                                                        <mat-error
                                                                                            *ngIf="subchild.get('StageDesc').errors?.maxlength && subchild.get('StageDesc').touched">
                                                                                            {{ 'label_stageDesc'
                                                                                            |translate}} {{
                                                                                            'label_errormaxlength100'
                                                                                            |translate}}
                                                                                        </mat-error>
                                                                                    </mat-form-field>
                                                                                    <mat-form-field class="mb-0 colorCode"
                                                                                        floatLabel="always">
                                                                                        <mat-label>{{ "label_colorCode" |
                                                                                            translate }}</mat-label>
            <!-- /*--@Who:Bantee,@When: 28-09-2023,@Why:EWM-12471,@What:When user swaps any two job workflow stage, color code of those stage is not swapped.-----*/ -->
                                                                                        
                                                                                        <input matInput formControlName="ColorCode" id="ColorCodesc_{{i}}{{ j }}" readonly>
                                                                                        <div matSuffix class="color-picker-button" [ngStyle]="{backgroundColor:subchild.get('ColorCode').value}" (click)="showColorPallate($event,'subchild',i,j,k)" cdkOverlayOrigin #trigger="cdkOverlayOrigin">
                                                                                        </div>
                                                                                        <!-- --------@When: 14-03-2023 @who:Renu @why: EWM-10634 ewm-11123 Desc- Custome color picker -------- -->
                                                                                        <ng-template cdkConnectedOverlay cdkConnectedOverlayBackdropClass="cdk-overlay-transparent-backdrop"
                                                                                        [cdkConnectedOverlayHasBackdrop]="true" [cdkConnectedOverlayOrigin]="trigger" [cdkConnectedOverlayOpen]="showColorPallateContainerSubchild[i+'_'+j+'_'+k]"
                                                                                        (backdropClick)="showColorPallateContainerSubchild[i+'_'+j+'_'+k] = false">
                                                                                            <!-- color picker body  -->
                                                                                            <div class="color-picker-default">
                                                                                                <input type="color" id="head" name="head"  (input)="onChaneColor($event,'subchild',i,j,k)">
                                                                                            </div>
                                                                                            <div class="color-picker-container" [style.opacity]="isMoreColorClicked ? '0' : ' '"
                                                                                                [style.display]="isMoreColorClicked ? 'none' : ' '">
                                                                                                <div class="themeColor">{{'label_selectColour' | translate}}</div>
                                                                                                <div class="picker theme-color">
                                                                                                    <div (click)="onSelectColor(codes,'subchild',i,j,k)" class="color-picker" *ngFor="let codes of themeColors"
                                                                                                        [ngStyle]="{backgroundColor:codes.colorCode}"> </div>
                                                                                                </div>
                                                                                                <div class="picker standard-color">
                                                                                                    <div (click)="onSelectColor(codes,'subchild',i,j,k)" class="color-picker" *ngFor="let codes of standardColor"
                                                                                                        [ngStyle]="{backgroundColor:codes.colorCode}">
                                                                                                    </div>
                                                                                                </div>
                                                                                                
                                                                                                <div class="footer">
                                                                                                    <div class="noFill" (click)="onSelectColor(null,'subchild',i,j,k)">
                                                                                                        <mat-icon>clear</mat-icon>
                                                                                                        <div class="noFillText">{{'label_clear'| translate}}</div>
                                                                                                    </div>
                                                                                                    <div class="more" (click)="closeTemplate()">
                                                                                                        <label for="head" class="noFill">
                                                                                                            <mat-icon fontSet="material-icons-outlined">palette</mat-icon>
                                                                                                            <span>{{'labelMore'| translate}}</span>
                                                                                                        </label>
                                                                                                    </div>
                                                                                                </div>
                                                                                            </div>
                                                                                            <!-- color picker body End-->
                                                                                        </ng-template>
                                                                                    </mat-form-field>
                                                                                </div>
                                                                                <div class="buttonGroup">
                                                                                    <button [disabled]="mode=='R'  || workflowUsed"
                                                                                        mat-stroked-button tabindex
                                                                                        color="warn"
                                                                                        id="btnRemove-Subchild-{{i}}{{j}}{{k}}"
                                                                                        class="remove-row addEsitDeleteButt"
                                                                                        type="button"
                                                                                        (click)="confirmDialogSubChildRow(i, j, k,subchild.get('IsNew').value)">
                                                                                        <mat-icon>delete_outline</mat-icon>
                                                                                    </button>
                                                                                </div>
                                                                            </div>
                                                                            <div class="checkboxGroupSec">
                                                                                <mat-slide-toggle color="primary" tabindex
                                                                                    class="jobPipeline" formControlName="Active"
                                                                                    (change)="changeActiveToggel($event,i,j,k,subchild.get('Active').value)"
                                                                                    id="Activesc_{{i}}{{ j }}{{ k }}"
                                                                                    labelPosition="before">
                                                                                    {{"label_statusActive" | translate }}?
                                                                                </mat-slide-toggle>
                                                                                <mat-slide-toggle color="primary" tabindex
                                                                                    formControlName="JobPipeline"
                                                                                    class="jobPipeline"
                                                                                    id="JobPipelinesc_{{i}}{{ j }}{{ k }}"
                                                                                    labelPosition="before">
                                                                                    {{"label_leadPipline" | customTranslate }}
                                                                                </mat-slide-toggle>
                                                                                <!-- <mat-slide-toggle disabled color="primary"
                                                                                    tabindex class="jobPipeline"
                                                                                    formControlName="BuiltIn"
                                                                                    id="BuiltInsc_{{i}}{{ j }}{{ k }}"
                                                                                    labelPosition="before">
                                                                                    {{"label_builtIn" | translate }}?
                                                                                </mat-slide-toggle>
                                                                                <mat-slide-toggle color="primary"
                                                                                    class="jobPipeline"
                                                                                    formControlName="AutomatedActions"
                                                                                    id="AutomatedActions_{{ i }}{{j}}{{k}}"
                                                                                    labelPosition="before">
                                                                                    {{"label_automatedActions" |translate }}?
                                                                                </mat-slide-toggle> -->
                                                                                <!-- @Who: Adarsh singh @When: 29-12-2022 @Why: ROST-9390.EWM-10074 -->
                                                                                <!-- map workflow features  -->
                                                                              
                                                                              
                                                                                <!-- map workflow features End -->
                                                                                <!-- @Who: Adarsh singh @When: 29-12-2022 @Why: ROST-9390.EWM-10074 END -->
                                                                                <div class="stagetype-box">
                                                                                    <ng-container *ngIf="parent.get('StageTypeCode').value">
                                                                                        <div class="stage-type-value">
                                                                                            <strong>{{"label_StageType" | translate }}:</strong>
                                                                                                    <!-------@suika @EWM-10500 stage color code display @whn 17-03-2023-->
                                                                                            <span>{{parent.get('StageTypeCode').value}} 
                                                                                                <span *ngIf="parent.get('StageTypeCode').value==newLead">-First stage</span>
                                                                                                <span *ngIf="parent.get('StageTypeCode').value==Closing">-Last stage</span>
                                                                                            </span>
                                                                                            <span [style.background-color]="parent.get('StageTypeColorCode').value"
                                                                                                class="stageColor"> </span>
                                                                                        </div>
                                                                                    </ng-container>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </mat-card>
                                                                </div>
                                                                <mat-card class="expandCollapseContent" [ngClass]="workflowUsed?'firstStep':''">
                                                                    <button type="button" class="drag-handle" mat-raised-button cdkDragHandle>
                                                                        <mat-icon>drag_indicator</mat-icon>
                                                                    </button>
                                                                    <div class="all-control">
                                                                        <div class="flex-row">
                                                                            <div class="form-controls">
                                                                                <div class="toggleButtonBox"></div>
                                                                                <mat-form-field class="stageName mb-0"
                                                                                    floatLabel="always">
                                                                                    <mat-label>{{ "label_stageName" |
                                                                                        translate
                                                                                        }}
                                                                                    </mat-label>
                                                                                    <input type="hidden"
                                                                                        formControlName="StageId"
                                                                                        id="StageId_{{i}}{{j}}{{k}}">
                                                                                    <input type="hidden"
                                                                                        formControlName="InternalCode"
                                                                                        id="InternalCodes_{{i}}{{j}}{{k}}">
    
                                                                                    <input type="hidden"
                                                                                        formControlName="ParentStageId"
                                                                                        id="ParentStageId_{{i}}{{j}}{{k}}">
                                                                                    <input type="hidden"
                                                                                        formControlName="IsNew"
                                                                                        id="IsNew_{{i}}{{j}}{{k}}">
    
                                                                                    <input tabindex
                                                                                        formControlName="StageName"
                                                                                        name="pStageName" matInput
                                                                                        (blur)="stageExists($event,subchild.get('InternalCode').value,subchild.get('ParentStageId').value,subchild)"
                                                                                        id="stageNamesc_{{i}}{{ j }}{{ k }}"
                                                                                        placeholder="{{ 'label_stageName' | translate }}"
                                                                                        required />
                                                                                    <mat-error
                                                                                        *ngIf="subchild.get('StageName').errors?.required && subchild.get('StageName').touched">
                                                                                        {{ 'label_stageName'
                                                                                        |translate}} {{
                                                                                        'label_errorreqired'
                                                                                        |translate}}
                                                                                    </mat-error>
                                                                                    
                                                                                    <mat-error
                                                                                        *ngIf="subchild.get('StageName').errors?.maxlength && subchild.get('StageName').touched">
                                                                                        {{ 'label_stageName'
                                                                                        |translate}} {{
                                                                                        'label_errormaxlength50'
                                                                                        |translate}}
                                                                                    </mat-error>
                                                                                    <mat-error
                                                                                        *ngIf="subchild.get('StageName').errors?.unique && subchild.get('StageName').touched">
                                                                                        {{ 'label_stageName'
                                                                                        |translate}} {{
                                                                                        'label_errorunique' |translate}}
                                                                                    </mat-error>
                                                                                    <mat-error
                                                                                        *ngIf="children.get('StageName').hasError('stageTaken')">
                                                                                        {{'label_stageName'|translate}}
                                                                                        {{'label_errorreqiredAlready'|translate}}
                                                                                    </mat-error>
                                                                                </mat-form-field>
                                                                                <mat-form-field
                                                                                    class="stageTextarea mb-0"
                                                                                    floatLabel="always">
                                                                                    <mat-label>{{ "label_stageDesc" |
                                                                                        translate
                                                                                        }}
                                                                                    </mat-label>
    
                                                                                    <textarea tabindex matInput
                                                                                        formControlName="StageDesc"
                                                                                        class="textareaHeight"
                                                                                        id="StageDescsc_{{i}}{{ j }}{{ k }}"
                                                                                        placeholder="{{ 'label_stageDesc' | translate }}"></textarea>
                                                                                    
                                                                                    <mat-error
                                                                                        *ngIf="subchild.get('StageDesc').errors?.maxlength && subchild.get('StageDesc').touched">
                                                                                        {{ 'label_stageDesc'
                                                                                        |translate}} {{
                                                                                        'label_errormaxlength100'
                                                                                        |translate}}
                                                                                    </mat-error>
                                                                                </mat-form-field>
                                                                                <mat-form-field class="mb-0 colorCode"
                                                                                    floatLabel="always">
                                                                                    <mat-label>{{ "label_colorCode" |
                                                                                        translate }}</mat-label>
        <!-- /*--@Who:Bantee,@When: 28-09-2023,@Why:EWM-12471,@What:When user swaps any two job workflow stage, color code of those stage is not swapped.-----*/ -->
                                                                                    
                                                                                    <input matInput formControlName="ColorCode" id="ColorCodesc_{{i}}{{ j }}" readonly>
                                                                                    <div matSuffix class="color-picker-button" [ngStyle]="{backgroundColor:subchild.get('ColorCode').value}" (click)="showColorPallate($event,'subchild',i,j,k)" cdkOverlayOrigin #trigger="cdkOverlayOrigin">
                                                                                    </div>
                                                                                    <!-- --------@When: 14-03-2023 @who:Renu @why: EWM-10634 ewm-11123 Desc- Custome color picker -------- -->
                                                                                    <ng-template cdkConnectedOverlay cdkConnectedOverlayBackdropClass="cdk-overlay-transparent-backdrop"
                                                                                    [cdkConnectedOverlayHasBackdrop]="true" [cdkConnectedOverlayOrigin]="trigger" [cdkConnectedOverlayOpen]="showColorPallateContainerSubchild[i+'_'+j+'_'+k]"
                                                                                    (backdropClick)="showColorPallateContainerSubchild[i+'_'+j+'_'+k] = false">
                                                                                        <!-- color picker body  -->
                                                                                        <div class="color-picker-default">
                                                                                            <input type="color" id="head" name="head"  (input)="onChaneColor($event,'subchild',i,j,k)">
                                                                                        </div>
                                                                                        <div class="color-picker-container" [style.opacity]="isMoreColorClicked ? '0' : ' '"
                                                                                            [style.display]="isMoreColorClicked ? 'none' : ' '">
                                                                                            <div class="themeColor">{{'label_selectColour' | translate}}</div>
                                                                                            <div class="picker theme-color">
                                                                                                <div (click)="onSelectColor(codes,'subchild',i,j,k)" class="color-picker" *ngFor="let codes of themeColors"
                                                                                                    [ngStyle]="{backgroundColor:codes.colorCode}"> </div>
                                                                                            </div>
                                                                                            <div class="picker standard-color">
                                                                                                <div (click)="onSelectColor(codes,'subchild',i,j,k)" class="color-picker" *ngFor="let codes of standardColor"
                                                                                                    [ngStyle]="{backgroundColor:codes.colorCode}">
                                                                                                </div>
                                                                                            </div>
                                                                                            
                                                                                            <div class="footer">
                                                                                                <div class="noFill" (click)="onSelectColor(null,'subchild',i,j,k)">
                                                                                                    <mat-icon>clear</mat-icon>
                                                                                                    <div class="noFillText">{{'label_clear'| translate}}</div>
                                                                                                </div>
                                                                                                <div class="more" (click)="closeTemplate()">
                                                                                                    <label for="head" class="noFill">
                                                                                                        <mat-icon fontSet="material-icons-outlined">palette</mat-icon>
                                                                                                        <span>{{'labelMore'| translate}}</span>
                                                                                                    </label>
                                                                                                </div>
                                                                                            </div>
                                                                                        </div>
                                                                                        <!-- color picker body End-->
                                                                                    </ng-template>
                                                                                </mat-form-field>
                                                                            </div>
                                                                            <div class="buttonGroup">
                                                                                <button [disabled]="mode=='R'  || workflowUsed"
                                                                                    mat-stroked-button tabindex
                                                                                    color="warn"
                                                                                    id="btnRemove-Subchild-{{i}}{{j}}{{k}}"
                                                                                    class="remove-row addEsitDeleteButt"
                                                                                    type="button"
                                                                                    (click)="confirmDialogSubChildRow(i, j, k,subchild.get('IsNew').value)">
                                                                                    <mat-icon>delete_outline</mat-icon>
                                                                                </button>
                                                                            </div>
                                                                        </div>
                                                                        <div class="checkboxGroupSec">
                                                                            <mat-slide-toggle color="primary" tabindex
                                                                                class="jobPipeline" formControlName="Active"
                                                                                (change)="changeActiveToggel($event,i,j,k,subchild.get('Active').value)"
                                                                                id="Activesc_{{i}}{{ j }}{{ k }}"
                                                                                labelPosition="before">
                                                                                {{"label_statusActive" | translate }}?
                                                                            </mat-slide-toggle>
                                                                            <mat-slide-toggle color="primary" tabindex
                                                                                formControlName="JobPipeline"
                                                                                class="jobPipeline"
                                                                                id="JobPipelinesc_{{i}}{{ j }}{{ k }}"
                                                                                labelPosition="before">
                                                                                {{"label_leadPipline" | customTranslate }}
                                                                            </mat-slide-toggle>
    
                                                                            <!-- <mat-slide-toggle disabled color="primary"
                                                                                tabindex class="jobPipeline"
                                                                                formControlName="BuiltIn"
                                                                                id="BuiltInsc_{{i}}{{ j }}{{ k }}"
                                                                                labelPosition="before">
                                                                                {{"label_builtIn" | translate }}?
                                                                            </mat-slide-toggle>
                                                                            <mat-slide-toggle color="primary"
                                                                                class="jobPipeline"
                                                                                formControlName="AutomatedActions"
                                                                                id="AutomatedActions_{{ i }}{{j}}{{k}}"
                                                                                labelPosition="before">
                                                                                {{"label_automatedActions" |translate }}?
                                                                            </mat-slide-toggle> -->
                                                                            <!-- @Who: Adarsh singh @When: 29-12-2022 @Why: ROST-9390.EWM-10074 -->
                                                                            <!-- map workflow features  -->
                                                                           
                                                                          
                                                                            <!-- map workflow features End -->
                                                                            <!-- @Who: Adarsh singh @When: 29-12-2022 @Why: ROST-9390.EWM-10074 END -->
                                                                            <div class="stagetype-box" *ngIf="parent.get('StageTypeCode').value">
                                                                                <div class="stage-type-value">
                                                                                    <strong>{{"label_StageType" | translate }}:</strong>
                                                                                            <!-------@suika @EWM-10500 stage color code display @whn 17-03-2023-->
                                                                                    <span>{{parent.get('StageTypeCode').value}} 
                                                                                        <span *ngIf="parent.get('StageTypeCode').value==newLead">-First stage</span>
                                                                                        <span *ngIf="parent.get('StageTypeCode').value==Closing">-Last stage</span>
                                                                                    </span>
                                                                                    <span [style.background-color]="parent.get('StageTypeColorCode').value"
                                                                                        class="stageColor"> </span>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </div>
                                                                </mat-card>
                                                            </div>
                                                        </ng-container>
                                                    </div>
                                                </div>
                                            </ng-container>
                                        </div>
                                        <div class="sepateCard"></div>
                                    </div>
                                </ng-container>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </mat-card>
    </mat-drawer-container>